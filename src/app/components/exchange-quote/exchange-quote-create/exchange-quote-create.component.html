<div class="right_col" role="main">
  <div class="x_content">
    <div class="card new-card">
      <div class="card-header header">
        <div class="row">
          <div class="col">
            <h4 class="header-name">{{id ? 'Edit' : 'Create'}} Exchange Quote
              <button class="btn-sm header-button header-button-alignment" (click)="toggle_po_header=!toggle_po_header">
                {{toggle_po_header ? 'Collapse' : 'Expand'}}
              </button>
            </h4>
          </div>
          <div>
            <button type="button" class="btn-sm header-button pull-right" matTooltipPosition="above"
              matTooltip="Exchange Quote List" [routerLink]="['/exchangemodule/exchangepages/exchange-quote-list']">
              Exchange Quote List
            </button>
          </div>
        </div>
      </div>
      <div class="card-body" *ngIf="!toggle_po_header" style="padding-top: 5px; padding-bottom: 0px;">
        <div class="form-row body-alignment">
          <div class="col-md-3">
            <div class="form-group">
              <label>Customer Name
                <span class="clr-red">*</span>
                <span style="color:blue" class="ng-star-inserted">
                  <a class="btn nobg" (click)="viewSelectedRow()" matTooltip="View" matTooltipPosition="above"><i
                      class="fa fa-eye"></i></a>
                </span>
              </label>
              <input type="text" [(ngModel)]="exchangeQuote.customerName" name="customerName" class="form-control"
                [disabled]="true" id="customerName" #customerName="ngModel" />
              <div *ngIf="customerName.invalid && (customerName.dirty || customerName.touched)"
                class="alert alert-danger alert-danger-cstm">
                <div *ngIf="customerName.errors.required">
                  <small>Customer Name is required </small>
                </div>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="form-group">
              <label>Customer Code</label>
              <input type="text" [(ngModel)]="exchangeQuote.customerCode" name="customerCode" class="form-control"
                [disabled]="true" id="customerCode" #customerCode="ngModel" />
            </div>
          </div>
          <div class="col-md-3">
            <div class="form-group">
              <label>Exch Quote Num <span class="clr-red">*</span></label>
              <input type="text" class="form-control" name="exchangeQuoteNumber"
                [(ngModel)]="exchangeQuote.exchangeQuoteNumber" [disabled]="true" #accountTypeId="ngModel"
                id="exchangeQuoteNumber" #exchangeQuoteNumber="ngModel" />
              <div *ngIf="exchangeQuoteNumber.invalid && (exchangeQuoteNumber.dirty || exchangeQuoteNumber.touched)"
                class="alert alert-danger alert-danger-cstm">
                <div *ngIf="exchangeQuoteNumber.errors.required">
                  <small> Exchange Quote Num is required </small>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="form-controls" style="margin-top: 0px;">
        <form #newExchangeQuoteForm="ngForm" class="form-horizontal">
          <div class="card" style="padding: 5px; margin: 5px;" *ngIf="toggle_po_header">
            <div class="mb-2">
              <div class="">
                <div class="col-md-6 main_ar">
                  <div class="">
                    <div class="col-md-6" style="padding:10px;">
                      <div class=" form-group">
                        <label class="radio-cstm wauto">
                          <input type="radio" value="1" checked="checked" [disabled]="editMode" name="optradio"
                            [(ngModel)]="exchangeQuote.type" />
                          <span class="checkmark"></span> Exchange
                        </label>
                        <label class="radio-cstm wauto">
                          <input type="radio" value="2" name="optradio2" [disabled]="editMode"
                            [(ngModel)]="exchangeQuote.type" />
                          <span class="checkmark"></span> Loan
                        </label>
                      </div>
                      <div class="form-group" style="padding-top: 5px;">
                        <label>Exch Quote Num <span class="clr-red">*</span></label>
                        <input type="text" class="form-control" name="exchangeQuoteNumber"
                          [(ngModel)]="exchangeQuote.exchangeQuoteNumber" [disabled]="true" #accountTypeId="ngModel"
                          id="exchangeQuoteNumber" #exchangeQuoteNumber="ngModel" />
                        <div
                          *ngIf="exchangeQuoteNumber.invalid && (exchangeQuoteNumber.dirty || exchangeQuoteNumber.touched)"
                          class="alert alert-danger alert-danger-cstm">
                          <div *ngIf="exchangeQuoteNumber.errors.required">
                            <small> Exch Quote Num is required </small>
                          </div>
                        </div>
                      </div>
                      <div class="form-group">
                        <label>Customer Ref<span class="clr-red">*</span></label>
                        <input type="text" required name="customerReference" id="customerReference"
                          #customerReference="ngModel" class="form-control"
                          [(ngModel)]="exchangeQuote.customerReference" (change)="onChangeInput()"
                          autocomplete=" off" />
                        <div *ngIf="customerReference.invalid && (customerReference.dirty || customerReference.touched)"
                          class="alert alert-danger alert-danger-cstm">
                          <div *ngIf="customerReference.errors.required">
                            <small>Customer Ref is required </small>
                          </div>
                        </div>
                      </div>
                      <div class="form-group">
                        <label>Open Date<span class="clr-red">*</span></label>
                        <p-calendar name="openDate" [yearNavigator]="true" [monthNavigator]="true" yearRange="1900:2100"
                          [(ngModel)]="exchangeQuote.openDate" [showIcon]="true" id="openDate" #openDate="ngModel"
                          required>
                          <!-- (onSelect)="onChangeOpenDate()"-->
                        </p-calendar>
                        <div *ngIf="openDate.invalid && (openDate.dirty || openDate.touched)"
                          class="alert alert-danger alert-danger-cstm">
                          <div *ngIf="openDate.errors.required">
                            <small> Open Date is required </small>
                          </div>
                        </div>
                      </div>
                      <div class="form-group">
                        <label>Quote Exp Date<span class="clr-red">*</span></label>
                        <p-calendar name="quoteExpireDate" [yearNavigator]="true" [monthNavigator]="true"
                          yearRange="1900:2100" [(ngModel)]="exchangeQuote.quoteExpireDate" [showIcon]="true"
                          id="quoteExpireDate" #quoteExpireDate="ngModel" required (onSelect)="onChangeOpenDate()">
                        </p-calendar>
                        <div *ngIf="quoteExpireDate.invalid && (quoteExpireDate.dirty || quoteExpireDate.touched)"
                          class="alert alert-danger alert-danger-cstm">
                          <div *ngIf="quoteExpireDate.errors.required">
                            <small> Quote Exp Date is required </small>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-6" style="padding:10px">
                        <div class="form-group" *ngIf="isEdit">
                          <label>Version Num</label>
                          <input type="text" [(ngModel)]="exchangeQuote.versionNumber" name="versionNumber"
                            class="form-control" id="versionNumber" [disabled]="true" #versionNumber="ngModel" />
                      </div>
                      <!-- <div class="form-group">
                        <label>Ver Date<span class="clr-red">*</span></label>
                        <p-calendar name="versionDate" [yearNavigator]="true" [monthNavigator]="true"
                          yearRange="1900:2100" [(ngModel)]="exchangeQuote.versionDate" [showIcon]="true"
                          id="versionDate" #versionDate="ngModel" required>
                        </p-calendar>
                        <div *ngIf="versionDate.invalid && (versionDate.dirty || versionDate.touched)"
                          class="alert alert-danger alert-danger-cstm">
                          <div *ngIf="versionDate.errors.required">
                            <small> Ver Date is required </small>
                          </div>
                        </div>
                      </div> -->
                      <div class="form-group">
                        <label>Priority <span class="clr-red">*</span></label>
                        <div>
                          <p-autoComplete field="label" [ngClass]="inputValidCheckHeader ? 'autocomplete-validate' : ''"
                            class="autocomplete" [(ngModel)]="exchangeQuote.priorityId" name="priorityName"
                            [suggestions]="allPriorityDetails" (completeMethod)="filterPriorityNames($event)"
                            [size]="30" [minLength]="1" [dropdown]="true" #priorityId="ngModel"
                            (onSelect)="onSelectPriority();" errorMessage="Records not found" [forceSelection]="true"
                            required></p-autoComplete>
                          <div *ngIf="priorityId.invalid && (priorityId.dirty || priorityId.touched)"
                            class="alert alert-danger alert-danger-cstm">
                            <div *ngIf="priorityId.errors.required">
                              <small> Priority is required </small>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="form-group">
                        <label>Status <span class="clr-red">*</span></label>
                        <select class="form-control" name="status" [(ngModel)]="exchangeQuote.statusId"
                          #statusId="ngModel" (ngModelChange)="enableHeaderSave(); onSelectStatus()" disabled required>
                          <option *ngFor="let item of exchangeStatusList" [ngValue]="item.value">{{item.label}}</option>
                        </select>
                        <div *ngIf="statusId.invalid && (statusId.dirty || statusId.touched)"
                          class="alert alert-danger alert-danger-cstm">
                          <div *ngIf="statusId.errors.required">
                            <small> Status is required </small>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-md-6 main_ar">
                  <div class="form-row">
                    <div class="col-md-6" style="padding:10px;">
                      <div class="form-group">
                        <label>Customer Name
                          <span class="clr-red">*</span>
                          <span style="color:blue" class="ng-star-inserted">
                            <a class="btn nobg" (click)="viewSelectedRow()" matTooltip="View"
                              matTooltipPosition="above"><i class="fa fa-eye"></i></a>
                          </span>
                        </label>
                        <input type="text" [(ngModel)]="exchangeQuote.customerName" name="customerName"
                          class="form-control" [disabled]="true" id="customerName" #customerName="ngModel" />
                        <div *ngIf="customerName.invalid && (customerName.dirty || customerName.touched)"
                          class="alert alert-danger alert-danger-cstm">
                          <div *ngIf="customerName.errors.required">
                            <small>Customer Name is required </small>
                          </div>
                        </div>
                      </div>
                      <div class="form-group">
                        <label>Customer Contact<span class="clr-red">*</span></label>
                        <select [(ngModel)]="exchangeQuote.customerContactId" required (change)="onChangeInput()"
                          [ngModelOptions]="{standalone: true}" name="customerContactId" id="customerContactId"
                          #customerContactId="ngModel">
                          <option value='-1'>--Select</option>
                          <option *ngFor="let contact of customerContactList" [ngValue]="contact.contactId">
                            {{contact.firstName}} {{contact.lastName}} -
                            {{ contact.workPhone }}
                          </option>
                        </select>
                        <div *ngIf="customerContactId.invalid && (customerContactId.dirty || customerContactId.touched)"
                          class="alert alert-danger alert-danger-cstm">
                          <div *ngIf="customerContactId.errors.required">
                            <small> Customer Contact is required </small>
                          </div>
                        </div>
                      </div>
                      <div class="form-group">
                        <label>Credit Limit &amp; terms<span class="clr-red">*</span></label>
                        <div class="col-md-5">
                          <input type="text" class="form-control" style="text-align:right;" name=" creditLimit"
                            [ngModel]="exchangeQuote.creditLimit | twoDecimalGlobalNumberFormatPipe"
                            (ngModelChange)="salesQuote.creditLimit=$event" required [disabled]="true" />
                        </div>
                        <div class="col-md-7">
                          <select name="creditTermId" [(ngModel)]="exchangeQuote.creditTermId"
                            [disabled]="true" required>
                            <option value='-1'>--Select</option>
                            <option *ngFor="let ct of creditTerms" [ngValue]="ct.value">
                              {{ ct.label }}</option>
                          </select>
                        </div>
                      </div>
                      <div class="form-group" style="padding-top:24px;">
                        <label style="width: 62px;">AR Balance </label><i class="fa fa-info-circle fa-lg"
                          matTooltipPosition="above" matTooltip="AR Bal before this Sales Order"></i>
                        <input type="text" class="form-control" style="text-align:right;" name="balanceDue"
                          [ngModel]="exchangeQuote.balanceDue | twoDecimalGlobalNumberFormatPipe"
                          (ngModelChange)="exchangeQuote.balanceDue=$event" [disabled]="true" />
                      </div>
                    </div>
                        <div class="col-md-6" style="padding:10px;">
                          <div class="form-group">
                            <label>Cust Req Date</label>
                            <p-calendar name="customerRequestDate" [yearNavigator]="true" [monthNavigator]="true"
                              yearRange="1900:2100" [(ngModel)]="exchangeQuote.customerRequestDate" [showIcon]="true"
                              id="customerRequestDate" [minDate]="exchangeQuote.openDate" #customerRequestDate="ngModel">
                            </p-calendar>
                            <!-- <div *ngIf="customerRequestDate.invalid && (customerRequestDate.dirty || customerRequestDate.touched)"
                              class="alert alert-danger alert-danger-cstm">
                              <div *ngIf="customerRequestDate.errors.required">
                                <small> Cust Req Date is required </small>
                              </div>
                            </div> -->
                          </div>
                          <div class="form-group">
                            <label>Promise Date<span class="clr-red">*</span></label>
                            <p-calendar name="promiseDate" [yearNavigator]="true" [monthNavigator]="true"
                              yearRange="1900:2100" [(ngModel)]="exchangeQuote.promiseDate" [showIcon]="true"
                              id="promiseDate" [minDate]="exchangeQuote.openDate" #promiseDate="ngModel" required>
                            </p-calendar>
                            <div *ngIf="promiseDate.invalid && (promiseDate.dirty || promiseDate.touched)"
                              class="alert alert-danger alert-danger-cstm">
                              <div *ngIf="promiseDate.errors.required">
                                <small> Promise Date is required </small>
                              </div>
                            </div>
                          </div>
                          <div class="form-group">
                            <label>Est Ship Date</label>
                            <p-calendar name="estimateShipDate" [yearNavigator]="true" [monthNavigator]="true"
                              yearRange="1900:2100" [(ngModel)]="exchangeQuote.estimateShipDate" [showIcon]="true"
                              id="estimateShipDate" [minDate]="exchangeQuote.openDate" #estimateShipDate="ngModel">
                            </p-calendar>
                            <!-- <div *ngIf="estimateShipDate.invalid && (estimateShipDate.dirty || estimateShipDate.touched)"
                              class="alert alert-danger alert-danger-cstm">
                              <div *ngIf="estimateShipDate.errors.required">
                                <small> Est Ship Date is required </small>
                              </div>
                            </div> -->
                          </div>
                          <div class="form-group">
                            <label>Sales Person</label>
                            <p-autoComplete class="autocomp-customer-cstm" name="salesPersonName"
                                [(ngModel)]="exchangeQuote.salesPersonName"
                                [suggestions]="salesFirstCollection" [forceSelection]="true"
                                emptyMessage="No Match Found" field="name"
                                (completeMethod)="filterSalesFirstName($event)" [size]="30"
                                [minLength]="1" [dropdown]="true">
                            </p-autoComplete>
                          </div>
                        </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-md-12">
              <button type="submit" *ngIf="((!isEdit && !isCreateModeHeader))" (click)="onSubmit(true)"
                  [disabled]="!newExchangeQuoteForm.form.valid"
                  class="btn pull-right submit-btn btn btn-primary">
                  Submit
              </button>
              <button type="submit" *ngIf="((isEdit && !isCreateModeHeader))||isHeaderSubmit"
                  [disabled]="enableUpdateButton" (click)="onSubmit(true)"
                  class="btn pull-right submit-btn btn btn-primary">
                  Update
              </button>
          </div>
          </div>
          <!-- <ng-container *ngIf="((isCreateModeHeader||isEdit))">
            <p-tabView class="pas-tabview" (onChange)="onTabChange($event)">
                <p-tabPanel header="Parts List" [selected]="true">
                    <app-sales-order-part-number [exchangeQuote]="exchangeQuote" [salesOrderId]="id"
                        [employeesList]="employeesList" [isViewMode]="false" [customer]="customerDetails"
                        [salesOrderView]="exchangeQuoteView" (on-parts-save)="onPartsSaveEvent($event)"
                        [totalCharges]="totalCharges" [totalFreights]="totalFreights"
                        [defaultSettingPriority]="defaultSettingPriority">
                    </app-sales-order-part-number>
                </p-tabPanel>
            </p-tabView>
        </ng-container> -->
        <ng-container *ngIf="((isCreateModeHeader||isEdit))">
            <p-tabView class="pas-tabview" (onChange)="onTabChange($event)">
                <p-tabPanel header="Parts List" [selected]="true">
                    <app-exchange-quote-part-number [exchangeQuote]="exchangeQuote" [exchangeQuoteId]="id"
                        [isViewMode]="false" [customer]="customerDetails"
                        [exchangeQuoteView]="exchangeQuoteView" (on-parts-save)="onPartsSaveEvent($event)">
                    </app-exchange-quote-part-number>
                </p-tabPanel>
                <p-tabPanel header="Internal Approvers">
                  <app-exchange-quote-approve>
                  </app-exchange-quote-approve>
                </p-tabPanel>
                <p-tabPanel header="Address">
                  <app-address-component *ngIf="showAddresstab" [addressType]="addressType" [id]="exchangeQuoteId">
                  </app-address-component>
                  <!-- <app-sales-address [customerId]="customerId" [salesQuoteView]="salesQuoteView"
                      [salesQuote]="salesQuote" [salesOrderQuote]="salesOrderQuote"></app-sales-address> -->
              </p-tabPanel>
              <p-tabPanel header="Hypothethical Analysis">
                <app-exchange-quote-analysis>
                </app-exchange-quote-analysis>
            </p-tabPanel>
            </p-tabView>
        </ng-container>
        </form>
      </div>
    </div>
  </div>
</div>
<ng-template #errorMessagePop let-c="close" let-d="dismiss">
  <div class="modal-header">
      <button type="button" class="close" data-dismiss="modal" (click)="closeErrorMessage()">&times;</button>
      <h4 class="modal-title"> Please Enter (*) Mandatory Fields</h4>
  </div>
  <div class="modal-body">
      <p *ngFor="let error of errorMessages" [ngStyle]="{'color':'red'}"> {{ error }} </p>
  </div>
  <div class="modal-footer">
      <button type="button" class="btn btn-danger" data-dismiss="modal" (click)="closeErrorMessage()">Close</button>
  </div>
</ng-template>
<div class="preloader" *ngIf="isSpinnerVisible">
  <div class="loading">
      <div class="lds-roller">
          <div></div>
          <div></div>
          <div></div>
          <div></div>
          <div></div>
          <div></div>
          <div></div>
          <div></div>
      </div>
  </div>
</div>