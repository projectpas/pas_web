<div style="padding: 2px 6px;">
  <div class="col-md-12 shadow-box-cstm">
    <div class="col-md-4">
      <p class="fs12">
        <label class="control-label labels-font-header" style="width: auto;">Customer Name:
        </label>
        <span class="span-header-red" style="text-transform: capitalize">
          {{ customerName }}
        </span>
      </p>
    </div>
    <div class="col-md-4">
      <p class="fs12">
        <label class="control-label labels-font-header" style="width: auto;">Customer Code:
        </label>
        <span class="span-header-red" style="text-transform: capitalize">
          {{ customerCode }}
        </span>
      </p>
    </div>
  </div>

  <div class="card new-card" style="margin-top: 0; padding: 10px">
    <div class="card-header bg-primary new-card-header" >
      <div class="row">
        <div class="col">
          <h4 class="new-card-heading"> ATA Chapter View</h4>
        </div>
      </div>
    </div>    
    <div class="clear"></div>
    <div class="card-body new-card-body">
    <p-table #dt class="rpo-table-cstm" 
    [rows]="pageSize" 
    [value]="ataListDataValues" 
    [rowsPerPageOptions]="[10, 20, 50, 100]" 
    [scrollable]="true" 
    [style]="{ width: '100%' }" 
    [paginator]="true" 
    [columns]="selectedColumns" 
    [resizableColumns]="true" 
    [reorderableColumns]="true" 
    selectionMode="multiple" 
    [metaKeySelection]="true"
    (onPage)="pageIndexChange($event)">
      <ng-template pTemplate="caption" let-columns>
        <div class="row">
          <div class="col">
            <p-multiSelect [options]="ataHeaders" [(ngModel)]="selectedColumns" [ngModelOptions]="{ standalone: true }"
              optionLabel="header" selectedItemsLabel="{0} columns selected" [style]="{ minWidth: '200px' }"
              defaultLabel="Choose Columns" style="float:left">
              <ng-template let-selectedColumns pTemplate="selectedItems">
                <ng-container>{{ selectedColumns?.length }} Columns Selected
                </ng-container>
              </ng-template>
            </p-multiSelect>
          </div>
        <div class="col">
          <div
            style="width: auto !important; float: right;"
            class="inner-addon right-addon w50 inline-block g-filter-search-cstm"
          >
            <i class="fa fa-search"></i>
            <input type="text" pInputText size="50" 
            class="form-control"
              (input)="dt.filterGlobal($event.target.value, 'contains')" placeholder="Filter"
              style="height: 28px !important;" 
              />
            </div>
          </div>
        </div>
        <div class="row">
            <div class="col">
              <button type="button" class="btn btn-primary new-table-button" pButton icon="fa-download" iconPos="left"
                label="Export All Data" matTooltip="Download  Data" matTooltipPosition="above"  data-toggle="modal" 
                (click)="selectedOnly = false; targetData = dt;"
                 data-target="#downloadExportPopup"
                style="padding: 5px 10px !important; width: 115px !important;"></button>
              <button type="button" class="btn btn-primary new-table-button" pButton icon="fa-download" iconPos="left"
                label="Export Selected Data" matTooltip="Download Selected Data" matTooltipPosition="above"
                (click)="dt.exportCSV({ selectionOnly: true })" style="padding: 5px 10px !important;"></button>
              <button class="btn btn-primary new-table-button " style="padding: 5px 10px !important; height: 26px !important; width: 130px !important;"
                *ngIf="showAdvancedSearchCard == false" type="button" (click)="enableDisableAdvancedSearch(true)">
                Advanced Search <i class="fa fa-caret-down"></i>
              </button>
              <button class="btn btn-primary new-table-button" style="padding: 5px 10px !important; height: 26px !important; width: 130px !important;"
                *ngIf="showAdvancedSearchCard == true" type="button" (click)="enableDisableAdvancedSearch(false)">
                Advanced Search <i class="fa fa-caret-up"></i>
              </button>
            </div>
        </div>
        <div class="row">
          <div class="col" style="margin-top: 10px !important;">
            <div class="row advance-search-card" *ngIf="showAdvancedSearchCard == true">
              <div class="col">
                <div class="col-md-1 col-md-1-cstm">
                <h4 class="f-s-14" style="margin-top: 26px;">Search:</h4>
              </div>
              <div class="col-md-3">
                <div class="form-group ">
                  <label class="fs12">Contact</label>
                  <p-multiSelect [options]="contactList" name="atasearch" [(ngModel)]="search_SelectedContact"
                    (onChange)="getContactsByCustomerId()" [panelStyle]="{ minWidth: '12em' }" class="pub-multi">
                  </p-multiSelect>
                </div>
              </div>
              <div class="col-md-3">
                <div class="form-group ">
                  <label class="fs12">ATA Chapter</label>
                  <p-multiSelect [options]="search_ataChapterList" name="atasearch" [(ngModel)]="search_SelectedATA"
                    (onChange)="getSubChapterByATAChapter()" [panelStyle]="{ minWidth: '12em' }" class="pub-multi">
                  </p-multiSelect>
                </div>
              </div>
              <div class="col-md-3">
                <div class="form-group">
                  <label class="fs12">
                    ATA Subchapter
                  </label>
                  <p-multiSelect [(ngModel)]="search_SelectedATASubChapter" [options]="search_ataSubChapterList"
                    name="ataSubchapter" [panelStyle]="{ minWidth: '12em' }" class="pub-multi"></p-multiSelect>
                </div>
              </div>
              <div class="col-md-1 add-new-align" style="padding-top: 20px !important;">
                <div class="form-group">
                  <button class="btn btn-primary mtop20" (click)="searchATA()">
                    <i class="pi pi-search pi-search"></i>
                  </button>
                </div>
              </div>
              </div>
            </div>
          </div> 
        </div>
        <!--/advanced search card-->
      </ng-template>
      <ng-template pTemplate="colgroup" let-columns>
        <colgroup>
          <col *ngFor="let col of columns" style="width:130px" />
        </colgroup>
      </ng-template>
      <ng-template pTemplate="header" let-columns>
        <tr>
          <th *ngFor="let col of columns" pResizableColumn pReorderableColumn [pSortableColumn]="col.field">
            {{ col.header }} <p-sortIcon [field]="col.field"></p-sortIcon>
          </th>
          <th style="width:70px;position:sticky">Action</th>
        </tr>
        <tr>
          <th style="width:auto" *ngFor="let col of columns" [ngSwitch]="col.field">
            <input style="width:100%;" pInputText type="text"
              (input)="dt.filter($event.target.value, col.field, 'contains')" />
          </th>
          <th style="width:70px;position:sticky"></th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-i="rowIndex" let-rowData let-columns="columns">
        <tr [pSelectableRow]="rowData" [pSelectableRowDblClick]="rowData">
            <td class="uiTable_td_ovrflw_control" *ngFor="let col of columns" pResizableColumn pReorderableColumn>
                <ng-container *ngIf="col.field != 'createdDate' && col.field != 'updatedDate'">
                  {{ rowData[col.field] }}  {{col.field == 'firstName' && rowData['lastName'] ? rowData['lastName'] : ''}}
              </ng-container>
              <ng-container *ngIf="col.field == 'createdDate' || col.field == 'updatedDate'">
                  {{rowData[col.field] | date: 'MM/dd/yyyy h:mm a'}}
              </ng-container>  
            </td>
          <td style="width:70px;position:sticky; text-align: center">
            <span data-toggle="modal" data-target="#contentATAChapterHist1"><a class="btn nobg"
                (click)="getATAAuditHistoryById(rowData)" matTooltip="History" matTooltipPosition="above"><i
                  class="fa fa-history"></i></a></span>
          </td>
        </tr>
      </ng-template>
      <ng-template pTemplate="emptymessage" let-columns *ngIf="ataListDataValues?.length == 0">
        <tr>
          <td [attr.colspan]="8" class="no-records-cstm">
            No records found
          </td>
        </tr>
      </ng-template>
      <ng-template pTemplate="summary" id="footer">
        <label id="footer" class="footer">Total:</label>
        <input style="width: 5%;" [(ngModel)]="dt._totalRecords" [disabled]="true" pInputText type="text" />
        &nbsp;&nbsp;
        <label id="footer" class="footer1">Pages Count:</label>

        <input style="width: 5%;" [ngModel]="getPageCount(dt._totalRecords, pageSize)" [disabled]="true" pInputText
          type="text" />
      </ng-template>
    </p-table>

    <div class="col-md-12">
      <button type="button" class="btn btn-primary pull-right submit-btn" (click)="nextClick()"
        [disabled]="stopmulticlicks">
        Next
      </button>
      <button type="button" class="btn btn-primary pull-right submit-btn" (click)="backClick()">
        Previous
      </button>
    </div>
  </div>
  <br />
</div>

<ng-template #deleteContent let-c="close" let-d="dismiss">
  <div class="modal-header">
    <h4 class="modal-title">Are You Sure Want to Delete?</h4>
    <button type="button" class="close" aria-label="Close" (click)="dismissModel()">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <strong>
      Contact Name:
      <span class="new-label">{{ selectedRowForDelete.firstName }}</span>
    </strong>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-success" (click)="deleteItemAndCloseModel()">
      Yes
    </button>
    <button type="button" class="btn btn-danger" (click)="dismissModel()">
      No
    </button>
  </div>
</ng-template>

<div class="modal fade" id="downloadExportPopup" role="dialog" data-backdrop="static" data-keyboard="false">
  <div class="modal-dialog modal-sm">
      <div class="modal-content">
          <div class="modal-header">
              <button type="button" class="close" (click)="closeDeleteModal()">&times;</button>
              <h4 class="modal-title">Are You Sure Want to Download?</h4>
          </div>
          <div class="modal-body" *ngIf="targetData">
              <strong>
                  <span>
                      You are attempting to export {{targetData.totalRecords}} of records. 
                  </span> 
              </strong>
          </div>
          <div class="modal-footer">
              <button type="button" class="btn btn-primary" (click)="(selectedOnly)?targetData.exportCSV({ selectionOnly: true }):exportCSV(targetData); closeDeleteModal();">Confirm</button>
              <button type="button" class="btn btn-danger" (click)="closeDeleteModal()">Cancel</button>
          </div>
      </div>
  </div>
</div>

<div id="contentATAChapterHist1" #contentATAChapterHist class="modal fade" role="dialog" data-backdrop="static"
  data-keyboard="false">
  <div class="modal-dialog modal-xl">
    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">
          &times;
        </button>
        <div class="col-md-12 shadow-box-cstm">
          <div class="col-md-6">
            <p class="fs12">
              <label class="control-label labels-font-header" style="width: auto;">Customer Name:
              </label>
              <span class="span-header-red" style="text-transform: capitalize">
                {{ customerName }}
              </span>
            </p>
          </div>
          <div class="col-md-6">
            <p class="fs12">
              <label class="control-label labels-font-header" style="width: auto;">Customer Code:
              </label>
              <span class="span-header-red" style="text-transform: capitalize">
                {{ customerCode }}
              </span>
            </p>
          </div>
        </div> 
        <h4 class="modal-title">History of ATA Chapter</h4>
      </div>
      <div class="modal-body" *ngIf="auditHistory1">
        <div class="table-responsive">
          <table class="table table-bordered" *ngIf="auditHistory1.length > 0; else noDatavailable">
            <thead>
              <tr>
                <th>Contact</th>
                <th>ATA Chapter Code</th>
                <th>ATA Chapter Name</th>
                <th>ATA Sub Chapter</th>
                <th>ATA Sub Code</th>                
                <th>Created Date</th>
                <th>Created By</th>
                <th>Updated Date</th>   
                <th>Updated By</th>                             
                <th>Is Deleted</th>
              </tr>
            </thead>
            <tbody *ngIf="auditHistory1.length > 0">
              <tr *ngFor="let audit of auditHistory1; let i = index">
                  <td [ngStyle]="{
                    color: getColorCodeForHistoryATA(
                      i,
                      'firstName',
                      audit.firstName
                    )
                      ? 'black'
                      : 'red'
                  }">
                      {{ audit.firstName }} {{ audit.lastName ? audit.lastName : ''}}
                  </td>

                <td [ngStyle]="{
                    color: getColorCodeForHistoryATA(
                      i,
                      'ataChapterCode',
                      audit.ataChapterCode
                    )
                      ? 'black'
                      : 'red'
                  }">
                  {{ audit.ataChapterCode }}
                </td>

                <td [ngStyle]="{
                    color: getColorCodeForHistoryATA(
                      i,
                      'ataChapterName',
                      audit.ataChapterName
                    )
                      ? 'black'
                      : 'red'
                  }">
                  {{ audit.ataChapterName }}
                </td>
                <td [ngStyle]="{
                    color: getColorCodeForHistoryATA(
                      i,
                      'ataSubChapterDescription',
                      audit.ataSubChapterDescription
                    )
                      ? 'black'
                      : 'red'
                  }">
                  {{ audit.ataSubChapterDescription }}
                </td>
                <td [ngStyle] ="{
                    color: getColorCodeForHistoryATA(
                      i,
                      'ataSubChapterCode',
                      audit.ataSubChapterCode
                    )
                      ? 'black'
                      : 'red'
                  }">
                    {{audit.ataSubChapterCode}}
                </td>
                <td>{{ audit.createdDate | date: 'MM/dd/yyyy h:mm a ' }}</td>
                <td [ngStyle] ="{
                    color: getColorCodeForHistoryATA(
                      i,
                      'createdBy',
                      audit.createdBy
                    )
                      ? 'black'
                      : 'red'
                  }">
                    {{audit.createdBy}}
                </td>
                <td>{{ audit.updatedDate | date: 'MM/dd/yyyy h:mm a ' }}</td>
                <td [ngStyle] ="{
                    color: getColorCodeForHistoryATA(
                      i,
                      'updatedBy',
                      audit.updatedBy
                    )
                      ? 'black'
                      : 'red'
                  }">
                    {{audit.updatedBy}}
                </td>
                <td style="background-color: #fff !important;"><p style="width: 50px; text-align: center;"> <input type="checkbox" name="isDeleted" [(ngModel)]="audit.isDeleted" disabled></p></td>
            </tr>
            </tbody>
          </table>
          <ng-template #noDatavailable>
            <div class="text-center">
              <h4 style="color: #ff5663;">No History Found</h4>
            </div>
          </ng-template>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-danger" data-dismiss="modal">
          Close
        </button>
      </div>
    </div>
  </div>
</div>
<div class="preloader" *ngIf="isSpinnerVisible">
  <div class="loading">
    <div class="lds-roller">
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
    </div>
  </div>
</div>