<div *ngIf="(fromWoList ==false || fromWoList ==undefined) && !isView">
    <button type="button" class="btn btn-primary" (click)="openPartNumber()" style="min-width: 97px !important;">
        Add PN
    </button>
    <button *ngIf="workOrderMaterialList && workOrderMaterialList.length > 0" class="btn btn-primary"
        (click)="partsIssueRI(1)" data-toggle="modal" style="min-width: 97px !important;" data-target="#reserve">Reserve
        Stock</button>
    <span *ngIf="!isSubWorkOrder">
        <button *ngIf="workOrderMaterialList && workOrderMaterialList.length > 0 && (enablePickTicket)"
            class="btn btn-primary" (click)="onclickpicktiket()" style="min-width: 97px !important;">Pick Ticket
        </button>
    </span>
    <button *ngIf="workOrderMaterialList && workOrderMaterialList.length > 0" class="btn btn-primary"
        (click)="partsIssueRI(2)" data-toggle="modal" data-target="#reserve" style="min-width: 97px !important;"> Issue
        Stock
    </button>
    <button *ngIf="workOrderMaterialList && workOrderMaterialList.length > 0 && !enablePickTicket && !isSubWorkOrder"
        class="btn btn-primary" (click)="partsIssueRI(3)" data-toggle="modal" data-target="#reserve"
        style="min-width: 97px !important;">
        Reserve & Issue </button>
        <button *ngIf="workOrderMaterialList && workOrderMaterialList.length > 0 && isSubWorkOrder"
            class="btn btn-primary" (click)="partsIssueRI(3)" data-toggle="modal" data-target="#reserve"
            style="min-width: 97px !important;">
            Reserve & Issue </button>
    <button *ngIf="workOrderMaterialList && workOrderMaterialList.length > 0" class="btn btn-primary"
        (click)="partsIssueRI(4)" data-toggle="modal" data-target="#reserve" style="min-width: 97px !important;">
        Unissue </button>
    <button *ngIf="workOrderMaterialList && workOrderMaterialList.length > 0" class="btn btn-primary"
        (click)="partsIssueRI(5)" data-toggle="modal" data-target="#reserve" style="min-width: 97px !important;">
        Unreserve </button>
</div>
<div id="addNewMaterials" class="modal fade" role="dialog" data-backdrop="static">
    <div class="modal-dialog modal-xlg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">{{ isEdit ? 'Edit' : 'Add' }} PN</h4>
            </div>
            <div class="modal-body">
                <div *ngIf="!isEdit && addNewMaterial">
                    <grd-material [isWorkOrder]="isWorkOrder" [customerId]="customerId"
                        [isSubWorkOrder]="isSubWorkOrder" [workFlow]="workFlowObject" [taskList]="taskList"
                        (saveMaterialListForWO)="saveMaterialList($event)" [mpnPartNumbersList]="mpnPartNumbersList">
                    </grd-material>
                </div>
                <div *ngIf="isEdit && editData && addNewMaterial">
                    <grd-material [isEdit]="isEdit" [editData]="editData" [isWorkOrder]="isWorkOrder"
                        [isSubWorkOrder]="isSubWorkOrder" [workFlow]="workFlowObject"
                        (updateMaterialListForWO)="updateMaterialList($event)"
                        [mpnPartNumbersList]="mpnPartNumbersList">
                    </grd-material>
                </div>
            </div>
        </div>
    </div>
</div>
<ng-template #addPart let-c="close" let-d="dismiss">
    <app-work-order-materials-add [isWorkOrder]="isWorkOrder" [isSubWorkOrder]="isSubWorkOrder" [isEdit]="isEdit"
        [isView]="isViewItem" [editData]="editData" [customerId]="customerId" [clearData]="clearData" [display]="show"
        [selectedParts]="selectedParts" (close)="onClose($event)" [type]="'WO'"
        (setmaterialListForSave)="setmaterialListForSave($event)"
        (setmaterialListForUpdate)="setmaterialListForUpdate($event)">
    </app-work-order-materials-add>
</ng-template>
<div *ngIf="ispickticket">
    <app-work-order-pickticket [referenceId]="this.savedWorkOrderData.workOrderId"></app-work-order-pickticket>
</div>
<div id="reserve" class="modal fade" role="dialog" data-backdrop="static">
    <div class="modal-dialog modal-xlg">
        <div class="modal-content">
            <div class="preloader" *ngIf="isSpinnerVisibleReserve">
                <div class="loading">
                    <div class="lds-roller">
                        <div></div>
                        <div></div>
                        <div></div>
                        <div></div>
                        <div></div>
                        <div></div>
                        <div></div>
                        <div></div>
                    </div>
                </div>
            </div>
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" (click)="closeMaterial()">&times;</button>
                <h4 class="modal-title" *ngIf="statusId === 1">Reserve Parts</h4>
                <h4 class="modal-title" *ngIf="statusId === 2">Issue Parts</h4>
                <h4 class="modal-title" *ngIf="statusId === 3">Reserve & Issue Parts</h4>
                <h4 class="modal-title" *ngIf="statusId === 4">Unissue Parts</h4>
                <h4 class="modal-title" *ngIf="statusId === 5">Unreserve Parts</h4>
                <p id="clockdiv" *ngIf="(statusId === 1 || statusId === 3) && counter" class="clockdiv"> Session Expire
                    in {{counter | formatTime}}</p>
            </div>
            <!-- <div class="form-row mar-left-15" *ngIf="statusId !== 2 && statusId !== 4 && statusId !== 5">
                <div class="col-md-2">
                    <p-checkbox class="p-checkbox-label-womaterial" name="task" binary="false" 
                        label="Include Alternate PN" (onChange)="resetAlternateParts($event)" [(ngModel)]="isShowAlternatePN">
                    </p-checkbox> 
                </div> 
                <div class="col-md-4" style="margin-left:-50px !important">
                    <p-checkbox class="p-checkbox-label-womaterial" name="task" binary="false" label="Include Eq PN"
                        (onChange)="resetEqParts($event)" [(ngModel)]="isShowEqPN"></p-checkbox>
                </div> 
            </div> -->
            <form #reserveData="ngForm">
                <div class="modal-body" *ngIf="reservedList">
                    <div class="table-responsive pas-table-cstm  poro-table-cstm parts-list-table-align"
                        id="workflow-attributes-block">
                        <div class="tableFixHead">
                            <table class="table table-bordered">
                                <thead>
                                    <tr>
                                        <th class="text-center" colspan="1"></th>
                                        <!-- <th *ngIf="isShowAlternatePN  " class="text-center" colspan="1"> </th> -->
                                        <!-- <th *ngIf=" isShowEqPN" class="text-center" colspan="1"> </th> -->
                                        <th colspan="12" class="text-center"> Materials</th>
                                        <th colspan="2" class="text-center"> Stock</th>
                                        <th class="text-center" colspan="4"></th>
                                    </tr>
                                    <tr>
                                        <th class="text-center select-all" style="min-width: 65px;">
                                            Select All
                                            <input type="checkbox" name="isSelectAll" [(ngModel)]="isAllow"
                                                (change)="allowAll($event.target.checked)">
                                        </th>
                                        <!-- <th *ngIf="isShowAlternatePN && (statusId == 1 || statusId == 3) " class="text-center">
                                        Alternate Parts
                                    </th> -->
                                        <!-- <th *ngIf="isShowEqPN && (statusId == 1 || statusId == 3)" class="text-center">
                                        Equivalent Parts
                                    </th> -->
                                        <th class="text-center" style="min-width: 110px;">PN </th>
                                        <th class="text-center" style="min-width: 130px;">Part Description</th>
                                        <th class="text-center" style="min-width: 110px;"
                                            *ngIf="(statusId == 2 || statusId == 4 || statusId == 5) && (showAlternateParts ||showEqParts) ">
                                            Alt/Equiv</th>
                                        <th class="text-center" style="min-width: 96px;"> Alternate PN For</th>
                                        <th class="text-center"> Cond Type</th>
                                        <th class="text-center width-50"> Stk Type</th>
                                        <th class="text-center width-50" style="width:60px !important">Qty Req</th>
                                        <th class="text-center width-50" style="width:60px !important">Qty Res</th>
                                        <th *ngIf="!isSubWorkOrder && statusId == 2 && enablePickTicket" class="text-center width-50" style="width:60px !important">Qty Picked</th>
                                        <th class="text-center" style="width:60px !important"> Qty To Be Reserved</th>
                                        <th class="text-center" style="width:60px !important">
                                            <span class="font-size-10" *ngIf="statusId == 1 || statusId == 5 ">
                                                {{ statusId != 5 ? 'Qty Actually Reserving' : 'Qty Actually
                                                UnReserving'}} </span>
                                            <span class="font-size-10" *ngIf="statusId == 2 || statusId == 4 ">
                                                {{ statusId != 4 ? 'Qty Actually Issuing' : 'Qty Actually UnIssuing'}}
                                            </span>
                                            <span class="font-size-10" *ngIf="statusId == 3"> Qty Actually Resver &
                                                Issue</span>
                                        </th>
                                        <th class="text-center" style="width:60px !important"> Qty Issued </th>
                                        <th class="text-center" style="width:60px !important"
                                            *ngIf="statusId !==2 && statusId !==4"> Qty To Be Issued
                                        </th>
                                        <th class="text-center" style="width:60px !important"
                                            *ngIf="statusId === 2  || statusId === 4"> Qty To Be Issued
                                        </th>
                                        <th class="text-center" style="width:60px !important"> Qty on Hand </th>
                                        <th class="text-center width-50" style="width:60px !important"> Qty Avail </th>
                                        <th class="text-center" style="width:60px !important"> Qty on Order </th>
                                        <th class="text-center" style="width: 110px !important;"
                                            *ngIf="statusId === 1 || statusId === 5 ">
                                            {{statusId == 1 ? 'Reserved' : 'UnReserved' }} Date <span
                                                class="clr-red">*</span></th>
                                        <th class="text-center" style="width: 130px !important;"
                                            *ngIf="statusId === 2 || statusId === 3 || statusId === 4">
                                            {{statusId === 2 ? 'Issued' :
                                            statusId === 3 ? 'Reserved & Issued'
                                            : 'UnIssued'
                                            }}
                                            Date <span class="clr-red">*</span></th>
                                        <th class="text-center" style="width: 130px !important;"
                                            *ngIf="statusId === 1 || statusId === 5">
                                            {{statusId === 1 ? 'Reserved' : 'UnReserved'}} By <span
                                                class="clr-red">*</span></th>
                                        <th class="text-center" style="width: 110px !important;"
                                            *ngIf="statusId === 2 || statusId === 3 || statusId === 4">
                                            {{statusId === 2 ? 'Issued' : statusId === 3 ? 'Reserved & Issued'
                                            :'UnIssued' }}
                                            By <span class="clr-red">*</span></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <ng-container *ngFor="let x of reservedList; let i=index;">
                                        <tr>
                                            <td class="text-center">
                                                <input type="checkbox" name="isParentSelected{{i}}"
                                                    *ngIf="(statusId === 1 || statusId === 5)"
                                                    [(ngModel)]="x.isParentSelected" (change)="selectedParts(x,$event)"
                                                    [disabled]="x.quantityReserved==0">
                                                <input type="checkbox" name="isParentSelected{{i}}"
                                                    *ngIf="(statusId === 2 || statusId === 3 || statusId === 4)"
                                                    [(ngModel)]="x.isParentSelected" (change)="selectedParts(x,$event)"
                                                    [disabled]="x.quantityIssued==0">
                                            </td>
                                            <td *ngIf="isShowAlternatePN && (statusId == 1 || statusId == 3)"
                                                class="text-center">
                                                <input type="checkbox" name="showAlternateParts{{i}}"
                                                    (change)="showAlternateParts($event , x.woReservedIssuedAltParts)"
                                                    [(ngModel)]="x.showAlternateParts">
                                            </td>
                                            <td *ngIf="isShowEqPN && (statusId == 1 || statusId == 3)"
                                                class="text-center">
                                                <input type="checkbox" name="showEqParts{{i}}"
                                                    (change)="showEquantParts($event , x.woReservedIssuedEquParts)"
                                                    [(ngModel)]="x.showEqParts">
                                            </td>
                                            <td>{{x.partNumber}}</td>
                                            <td>{{x.partDescription}}</td>
                                            <td *ngIf="(statusId == 2 || statusId == 4 || statusId == 5)"></td>
                                            <td></td>
                                            <td>{{x.condition}}</td>
                                            <td>{{x.stockType}}</td>
                                            <td class="tex_end text-right">
                                                {{x.quantity}}
                                            </td>
                                            <td class="tex_end text-right">
                                                {{x.quantityAlreadyReserved}}
                                            </td>
                                            <td *ngIf="!isSubWorkOrder && statusId == 2 && enablePickTicket" class="tex_end text-right">
                                                {{x.quantityPicked}}
                                            </td>
                                            <td class="tex_end text-right" *ngIf="(statusId === 1 || statusId === 5)">
                                                {{ statusId !=5 ? x.qtyToBeReserved : x.qtyToBeReserved}}
                                            </td>
                                            <td class="tex_end text-right"
                                                *ngIf="(statusId === 2 || statusId === 3 || statusId === 4)">
                                                {{x.qtyToBeReserved}}
                                            </td>
                                            <td *ngIf="(statusId === 1 || statusId === 5)">
                                                <input type="number" name="quantity{{i}}"
                                                    [(ngModel)]="x.quantityReserved" maxLength="12" (keypress)="restrictMinus($event)"
                                                    (keyup)="validatePartsQuantity($event,x)" (change)="handleQty(x)"
                                                    [disabled]="!x.isParentSelected">
                                            </td>
                                            <td *ngIf="!isSubWorkOrder &&  (statusId === 2  || statusId === 3 || statusId === 4)">
                                                <input type="number" name="quantity{{i}}" [(ngModel)]="x.quantityIssued"
                                                    (change)="handleQty(x)" maxLength="12" (keypress)="restrictMinus($event)"
                                                    (keyup)="validatePartsQuantity($event,x)"
                                                    [disabled]="!x.isParentSelected">
                                                  
                                                    <!-- <input type="number" name="quantity{{i}}" [(ngModel)]="x.quantityIssued"
                                                    (change)="handleQty(x)" (keypress)="restrictMinus($event)"
                                                    (keyup)="validatePartsQuantity($event,x)"
                                                    [disabled]="!x.isParentSelected"> -->

                                            </td>
                                            <td *ngIf="(( statusId === 2  || statusId === 3 || statusId === 4) && isSubWorkOrder)">
                                                <input type="number" name="quantity{{i}}" maxLength="12" [(ngModel)]="x.quantityIssued"
                                                    (change)="handleQty(x)" (keypress)="restrictMinus($event)"
                                                    (keyup)="validatePartsQuantity($event,x)"
                                                    [disabled]="!x.isParentSelected">
                                            </td>
                                            <!-- <td *ngIf="!isSubWorkOrder && (statusId === 2 && enablePickTicket)">
                                                <input type="number" name="quantity{{i}}" [(ngModel)]="x.quantityIssued"
                                                    (change)="handleQty(x)" (keypress)="restrictMinus($event)"
                                                    (keyup)="validatePartsQuantity($event,x)"
                                                    [disabled]="!x.isParentSelected">
                                            </td> -->
                                            <td class="tex_end text-right">
                                                {{x.quantityAlreadyIssued}}
                                            </td>
                                            <td class="tex_end text-right">
                                                {{x.qtyToBeIssued}}
                                            </td>
                                            <td class="tex_end text-right">{{x.quantityOnHand}}</td>
                                            <td class="tex_end text-right">{{x.quantityAvailable}}</td>
                                            <td class="tex_end text-right">{{x.quantityOnOrder}}</td>
                                            <td *ngIf="statusId != 2 && statusId != 3 && statusId != 4">
                                                <p-calendar [showIcon]="true" class="calender-cstm"
                                                    name="reservedDate{{i}}" #reservedDate="ngModel"
                                                    [required]="x.isParentSelected" [maxDate]="minDateValue"
                                                    [(ngModel)]="x.reservedDate" [maxDate]="minDateValue" disabled>
                                                </p-calendar>
                                            </td>
                                            <td *ngIf="statusId != 1 &&  statusId != 5 ">
                                                <p-calendar [showIcon]="true" class="calender-cstm"
                                                    name="issuedDate{{i}}" #issuedDate="ngModel"
                                                    [(ngModel)]="x.issuedDate" [maxDate]="minDateValue"
                                                    [required]="x.isParentSelected" [maxDate]="minDateValue" disabled>
                                                </p-calendar>
                                            </td>
                                            <td *ngIf="statusId != 2 && statusId  != 3 && statusId != 4">
                                                <p-autoComplete field="name" [(ngModel)]="x.reservedById"
                                                    name="reservedBy{{i}}" #reservedBy="ngModel"
                                                    errorMessage="Records not found" [forceSelection]="true"
                                                    [dropdown]="true" [suggestions]="employeeList"
                                                    (completeMethod)="filterEmployee($event)"
                                                    (onClear)="clearautoCompleteInput(workOrderGeneralInformation, 'employeeId' )"
                                                    appendTo='body' [baseZIndex]="9999" [size]="30" [minLength]="1"
                                                    [dropdown]="true" class="p-autoComplete-ctsm"
                                                    [required]="x.isParentSelected" disabled>
                                                </p-autoComplete> 
                                            </td>
                                            <td *ngIf="statusId != 1 && statusId != 5 ">
                                                <p-autoComplete field="name" appendTo='body' [baseZIndex]="9999"
                                                    [(ngModel)]="x.issuedById" name="issuedBy{{i}}" #issuedBy="ngModel"
                                                    errorMessage="Records not found" [forceSelection]="true"
                                                    [dropdown]="true" [suggestions]="employeeList"
                                                    (completeMethod)="filterEmployee($event)"
                                                    (onClear)="clearautoCompleteInput(workOrderGeneralInformation, 'employeeId' )"
                                                    [size]="30" [minLength]="1" [dropdown]="true"
                                                    class="p-autoComplete-ctsm" disabled
                                                    [required]="x.isParentSelected">
                                                </p-autoComplete>
                                            </td>
                                        </tr>
                                        <ng-container *ngIf="x.showAlternateParts==true && isVisible==true">
                                            <tr *ngFor="let b of x.woReservedIssuedAltParts; let y=index;">
                                                <td class="text-center">
                                                    <input type="checkbox" *ngIf="(statusId === 1 || statusId === 5)"
                                                        [(ngModel)]="b.isChildSelected"
                                                        [disabled]="b.quantityReserved==0" name="isChildSelected{{y}}"
                                                        (change)="selectedParts(b,$event)">
                                                    <input type="checkbox"
                                                        *ngIf="(statusId === 2 || statusId === 3 || statusId === 4)"
                                                        [(ngModel)]="b.isChildSelected" name="isChildSelected{{y}}"
                                                        (change)="selectedParts(b,$event)"
                                                        [disabled]="x.quantityIssued==0">
                                                </td>
                                                <td *ngIf="isShowAlternatePN && (statusId == 1 || statusId == 3)">
                                                </td>
                                                <td *ngIf="isShowEqPN && (statusId == 1 || statusId == 3)">
                                                </td>
                                                <td>{{b.altPartNumber}}</td>
                                                <td>{{b.altPartDescription}}</td>
                                                <td *ngIf="statusId == 2 || statusId == 4 || statusId == 5">
                                                    <span>Alternative</span>
                                                </td>
                                                <td>{{b.parentPartNo}}</td>
                                                <td>{{b.condition}}</td>
                                                <td>{{b.stockType}}</td>
                                                <td class="tex_end text-right">
                                                    {{b.quantity}}
                                                </td>
                                                <td class="tex_end text-right"> {{b.quantityAlreadyReserved}}</td>
                                                <td class="tex_end text-right">
                                                    {{b.qtyToBeReserved}}
                                                </td>
                                                <td *ngIf="(statusId === 1 || statusId === 5)">
                                                    <input type="number" name="quantity1_{{y}}"
                                                        [(ngModel)]="b.quantityReserved"
                                                        (keypress)="restrictMinus($event)" maxLength="12"
                                                        (keyup)="validatePartsQuantity($event,b)"
                                                        (input)="childPartValidate($event.target.value, b,1)"
                                                        [disabled]="b.quantityReserved==0">
                                                </td>
                                                <td *ngIf="(statusId === 2 || statusId === 3 || statusId === 4)">

                                                    <input type="number" name="quantity2_{{y}}"
                                                        [(ngModel)]="b.quantityIssued"
                                                        (keypress)="restrictMinus($event)"  maxLength="12"
                                                        (keyup)="validatePartsQuantity($event,b)"
                                                        (input)="childPartValidate($event.target.value, b,1)"
                                                        [disabled]="b.quantityIssued==0">
                                                </td>
                                                <td class="tex_end text-right">{{b.quantityAlreadyIssued}}</td>
                                                <td class="tex_end text-right">{{b.qtyToBeIssued}}</td>
                                                <td class="tex_end text-right">
                                                    {{b.quantityOnHand}}
                                                </td>
                                                <td class="tex_end text-right">
                                                    {{b.quantityAvailable}}
                                                </td>
                                                <td class="tex_end text-right">
                                                    {{b.quantityOnOrder}}
                                                </td>
                                                <td *ngIf="statusId != 2 && statusId != 3 && statusId != 4">
                                                    <p-calendar [showIcon]="true" class="calender-cstm"
                                                        name="reservedDateAlt{{y}}" #reservedDateAlt="ngModel"
                                                        [required]="b.isChildSelected" disabled
                                                        [(ngModel)]="b.reservedDate"></p-calendar>
                                                </td>
                                                <td *ngIf="statusId != 1 &&  statusId != 5 ">
                                                    <p-calendar [showIcon]="true" class="calender-cstm"
                                                        name="issuedDateAlt{{y}}" #issuedDateAlt="ngModel"
                                                        [(ngModel)]="b.issuedDate" disabled
                                                        [required]="b.isChildSelected">
                                                    </p-calendar>

                                                </td>
                                                <td *ngIf="statusId != 2 && statusId  != 3 && statusId != 4">
                                                    <p-autoComplete field="name" [(ngModel)]="b.reservedById"
                                                        name="reservedByAlt{{y}}" #reservedByAlt="ngModel"
                                                        errorMessage="Records not found" [forceSelection]="true"
                                                        [dropdown]="true" [suggestions]="employeeList"
                                                        (completeMethod)="filterEmployee($event)"
                                                        (onClear)="clearautoCompleteInput(workOrderGeneralInformation, 'employeeId' )"
                                                        appendTo='body' [baseZIndex]="9999" [size]="30" [minLength]="1"
                                                        [dropdown]="true" class="p-autoComplete-ctsm"
                                                        [required]="b.isChildSelected" disabled>
                                                    </p-autoComplete>
                                                </td>
                                                <td *ngIf="statusId != 1 && statusId != 5 ">
                                                    <p-autoComplete field="name" [(ngModel)]="b.issuedById"
                                                        name="issuedByAlt{{y}}" #issuedByAlt="ngModel"
                                                        errorMessage="Records not found" [forceSelection]="true"
                                                        [dropdown]="true" [suggestions]="employeeList"
                                                        (completeMethod)="filterEmployee($event)"
                                                        (onClear)="clearautoCompleteInput(workOrderGeneralInformation, 'employeeId' )"
                                                        [size]="30" [minLength]="1" [dropdown]="true"
                                                        class="p-autoComplete-ctsm" appendTo='body' [baseZIndex]="9999"
                                                        [required]="b.isChildSelected" disabled>
                                                    </p-autoComplete>
                                                </td>
                                            </tr>
                                        </ng-container>
                                        <ng-container *ngIf="x.showEqParts==true && isVisible==true">
                                            <tr *ngFor="let c of x.woReservedIssuedEquParts; let z=index; ">
                                                <td class="text-center">
                                                    <input type="checkbox" *ngIf="(statusId === 1 || statusId === 5)"
                                                        [(ngModel)]="c.isChildSelected"  maxLength="12"
                                                        [disabled]="c.quantityReserved==0" name="isChildSelected{{z}}"
                                                        (change)="selectedParts(c,$event)">

                                                    <input type="checkbox"  maxLength="12"
                                                        *ngIf="(statusId === 2 || statusId === 3 || statusId === 4)"
                                                        [(ngModel)]="c.isChildSelected" [disabled]="c.quantityIssued==0"
                                                        name="isChildSelected{{z}}" (change)="selectedParts(c,$event)">
                                                </td>
                                                <td *ngIf="isShowAlternatePN && (statusId == 1 || statusId == 3)">
                                                </td>
                                                <td *ngIf="isShowEqPN && (statusId == 1 || statusId == 3)">
                                                </td>
                                                <td *ngIf="statusId == 2 || statusId == 4 || statusId == 5">
                                                    <span>Equivalent</span>
                                                </td>
                                                <td>{{c.equPartNumber}}</td>
                                                <td>{{c.equPartDescription}}</td>
                                                <td>{{c.parentPartNo}}</td>
                                                <td>{{c.condition}}</td>
                                                <td>{{c.stockType}}</td>
                                                <td class="tex_end text-right">
                                                    {{c.quantity}}
                                                </td>
                                                <td class="tex_end text-right">{{c.quantityAlreadyReserved}}</td>
                                                <td class="tex_end text-right">
                                                    {{c.qtyToBeReserved}}
                                                </td>
                                                <td *ngIf="(statusId === 1 || statusId === 5)">
                                                    <input type="number" name="quantity11_{{z}}"
                                                        [(ngModel)]="c.quantityReserved"
                                                        (keypress)="restrictMinus($event)"  maxLength="12"
                                                        (keyup)="validatePartsQuantity($event,c)"
                                                        (input)="childPartValidate($event.target.value, c,2)"
                                                        [disabled]="!c.isChildSelected">
                                                </td>
                                                <td *ngIf="(statusId === 2 || statusId === 3 || statusId === 4)">
                                                    <input type="number" name="quantity22_{{z}}"
                                                        [(ngModel)]="c.quantityIssued"
                                                        (keyup)="validatePartsQuantity($event,c)"  maxLength="12"
                                                        (keypress)="restrictMinus($event)"
                                                        (input)="childPartValidate($event.target.value, c,2)"
                                                        [disabled]="!c.isChildSelected">
                                                </td>
                                                <td class="tex_end text-right">{{c.quantityAlreadyIssued}}</td>
                                                <td class="tex_end text-right">{{c.qtyToBeIssued}}</td>
                                                <td class="tex_end text-right">
                                                    {{c.quantityOnHand}}
                                                </td>
                                                <td class="tex_end text-right">
                                                    {{c.quantityAvailable}}
                                                </td>
                                                <td class="tex_end text-right">
                                                    {{c.quantityOnOrder}}
                                                </td>
                                                <td *ngIf="statusId != 2 && statusId != 3 && statusId != 4">
                                                    <p-calendar [showIcon]="true" class="calender-cstm"
                                                        name="reservedDateEq{{i}}" #reservedDateEq="ngModel"
                                                        [required]="c.isChildSelected" [maxDate]="minDateValue" disabled
                                                        appendTo='body' [baseZIndex]="9999"
                                                        [(ngModel)]="c.reservedDate"></p-calendar>
                                                </td>
                                                <td *ngIf="statusId != 1 &&  statusId != 5 ">
                                                    <p-calendar [showIcon]="true" class="calender-cstm"
                                                        name="issuedDateEq{{z}}" appendTo="body" #issuedDateEq="ngModel"
                                                        [(ngModel)]="c.issuedDate" [maxDate]="minDateValue" disabled
                                                        appendTo='body' [baseZIndex]="9999"
                                                        [required]="c.isChildSelected">
                                                    </p-calendar>
                                                </td>
                                                <td *ngIf="statusId != 2 && statusId  != 3 && statusId != 4">
                                                    <p-autoComplete field="name" [(ngModel)]="c.reservedById"
                                                        name="reservedByEq{{z}}" #reservedByEq="ngModel"
                                                        errorMessage="Records not found" [forceSelection]="true"
                                                        [dropdown]="true" [suggestions]="employeeList"
                                                        (completeMethod)="filterEmployee($event)"
                                                        (onClear)="clearautoCompleteInput(workOrderGeneralInformation, 'employeeId' )"
                                                        appendTo='body' [baseZIndex]="9999" [size]="30" [minLength]="1"
                                                        [dropdown]="true" class="p-autoComplete-ctsm"
                                                        [required]="c.isChildSelected" disabled>
                                                    </p-autoComplete>
                                                </td>
                                                <td *ngIf="statusId != 1 && statusId != 5 ">
                                                    <p-autoComplete field="name" appendTo='body' [baseZIndex]="9999"
                                                        [(ngModel)]="c.issuedById" name="issuedByEq{{z}}"
                                                        #issuedByEq="ngModel" errorMessage="Records not found"
                                                        [forceSelection]="true" [dropdown]="true"
                                                        [suggestions]="employeeList"
                                                        (completeMethod)="filterEmployee($event)"
                                                        (onClear)="clearautoCompleteInput(workOrderGeneralInformation, 'employeeId' )"
                                                        [size]="30" [minLength]="1" [dropdown]="true"
                                                        class="p-autoComplete-ctsm" [required]="c.isChildSelected"
                                                        disabled>
                                                    </p-autoComplete>
                                                </td>
                                            </tr>
                                        </ng-container>
                                    </ng-container>
                                    <tr *ngIf="reservedList && reservedList.length ==0">
                                        <td colspan="18" class="no-records-msg no-records-cstm">
                                            No records found
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div style="float:right">
                        </div>
                    </div>
                </div>
                <div class="modal-footer"> 
                    <!-- !savebutonDisabled  || checkActiveStatus || checkIsSeclected()-->
                    <button class="btn btn-primary" data-dismiss="modal" (click)="saveRIPart()"
                        [disabled]="!savebutonDisabled || checkIsSeclected()">
                        <span *ngIf="statusId === 1">Reserve</span>
                        <span *ngIf="statusId === 2">Issue</span>
                        <span *ngIf="statusId === 3">Reserve & Issue</span>
                        <span *ngIf="statusId === 4"> Unissue</span>
                        <span *ngIf="statusId === 5">Unreserve</span>
                    </button>
                    <button type="button" class="btn btn-danger" data-dismiss="modal"
                        (click)="closeMaterial()">Cancel</button>
                </div>
            </form>
        </div>
    </div>
</div>
<ng-template #timerAlertNotfi let-c="close" let-d="dismiss">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" (click)="dismissTimerAlert()">&times;</button>
        <h4 class="modal-title">Confirmation</h4>
    </div>
    <div class="modal-body">
        <h6 class="text-center">
            your session getting timeout do you want to reset the time
        </h6>
    </div>
    <div class="modal-footer">

        <button type="button" class="btn btn-danger" data-dismiss="modal" (click)="dismissTimerAlert()">No</button>
        <button type="button" class="btn btn-primary" data-dismiss="modal" (click)="actionTimerReset()">Yes</button>
    </div>
</ng-template>
<ng-template #tabRedirectConfirmationModal let-c="close" let-d="dismiss">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" (click)="dismissModel()">
            &times;
        </button>
        <h4 class="modal-title">Confirmation</h4>
    </div>
    <div class="modal-body">
        <h6 class="text-center">
            Do you to create new Sub Work Order or Add to existing Work Order ?
        </h6>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-danger"  
            data-dismiss="modal" (click)="addToExistingSubWo(existingSubWo)">
            Add to Existing Record
        </button>
        <button type="button" class="btn btn-primary" data-dismiss="modal" (click)="createNewSubWo()">
            Create New </button>
    </div>
</ng-template>
<!-- <div id="existingSubWo" class="modal fade" role="dialog" data-backdrop="static">
    <div class="modal-dialog modal-xlg">
        <div class="modal-content"> -->
            <ng-template #existingSubWo let-c="close" let-d="dismiss">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" (click)="dismissModel2()">&times;</button>
                <h4 class="modal-title">Sub Work Order List</h4>
            </div>
            <div class="modal-body" *ngIf="subWoRecord && subWoRecord.workOrderMaterialsId !=0 && viewSubWolist==true">
                <app-sub-work-orderlist [workOrderId]="workOrderId" [mpnId]="mpnId" (triggerModelData)='updateModel($event)' [forSubWorkOrder]="true"
                    [workOrderMaterialsId]="subWoRecord.workOrderMaterialsId">
                </app-sub-work-orderlist>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-danger btn-height" data-dismiss="modal"
                    (click)="dismissModel2()">Close</button>
            </div>
        </ng-template>
        <!-- </div>
    </div>
</div> -->
<ng-template #content let-c="close" let-d="dismiss">
    <div class="modal-header">

        <h4 class="modal-title">Are You Sure Want to Delete?</h4>
        <button type="button" class="close" aria-label="Close" (click)="dismissModel()">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body">
        <strong>
            PN:
            <span class="new-label">{{currentRow.partNumber}}</span>
        </strong>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-primary" (click)="delete()">Yes</button>
        <button type="button" class="btn btn-danger" (click)="dismissModel()">No</button>
    </div>
</ng-template>
<ng-template #Stockcontent let-c="close" let-d="dismiss">
    <div class="modal-header">

        <h4 class="modal-title">Are You Sure Want to Delete?</h4>
        <button type="button" class="close" aria-label="Close" (click)="dismissModel()">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body">
        <strong>
            PN:
            <span class="new-label">{{currentRow.partNumber}}</span>
        </strong>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-primary" (click)="deleteStock()">Yes</button>
        <button type="button" class="btn btn-danger" (click)="dismissModel()">No</button>
    </div>
</ng-template>
<div id="materialAudit" class="modal fade" role="dialog" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog modal-xlg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">
                    &times;
                </button>
                <h4 class="modal-title">Material History </h4>
            </div>
            <div class="modal-body">
                <div class="table-responsive pas-table-cstm poro-table-cstm parts-list-table-align">
                    <div class="tableFixHead ">
                        <!-- history_hg -->
                        <table class="table table-bordered" style="white-space: nowrap;">

                            <!-- <span class="clr-red">*</span> -->
                            <ng-container>
                                <thead>
                                    <tr>
                                        <th rowspan="2">Task</th>
                                        <th rowspan="2" style="min-width:160px !important">PN </th>
                                        <th rowspan="2" style="min-width:200px !important">PN Description</th>
                                        <th rowspan="2" class="min-width-70">Serial Num</th>
                                        <th rowspan="2" class="min-width-70">Cond</th>
                                        <th rowspan="2" class="min-width-80">Stk Line Num</th>
                                        <th rowspan="2" class="min-width-80">Request Type</th>
                                        <th rowspan="2">Provision</th>
                                        <!-- <th rowspan="2">PO Num </th> -->
                                        <th rowspan="2" class="min-width-60">Qty Req</th>
                                        <th rowspan="2" class="min-width-60">Qty Res </th>
                                        <th rowspan="2" class="min-width-60">Qty Iss</th>
                                        <th rowspan="2" class="min-width-70">Qty Turned In</th>
                                        <th rowspan="2" class="min-width-60">Qty OH</th>
                                        <th rowspan="2" class="min-width-60">Qty Avail</th>
                                        <th rowspan="2" class="min-width-60">Qty Rem</th>
                                        <th rowspan="2" class="min-width-60">UOM</th>
                                        <th rowspan="2" class="min-width-70">Stk Type</th>
                                        <th rowspan="2">Classification</th>
                                        <th rowspan="2" class="min-width-80">Qty On Order</th>
                                        <th rowspan="2" style="min-width:100px !important">Qty on BK Order</th>
                                        <th rowspan="2">Need Date</th>
                                        <th rowspan="2" class="min-width-70">Cntl Num</th>
                                        <th rowspan="2" class="min-width-70">Cntl ID</th>
                                        <th rowspan="2">Cur</th>
                                        <th rowspan="2" class="min-width-70">Unit Cost</th>
                                        <th rowspan="2" class="min-width-90">Extended Cost </th>
                                        <th rowspan="2">Cost Date</th>
                                        <th rowspan="2" class="min-width-80">PO Num </th>
                                        <th rowspan="2" class="min-width-60">RO Num</th>
                                        <th rowspan="2" class="min-width-60">Rec Num </th>
                                        <th rowspan="2" class="min-width-60">WO Num</th>
                                        <th rowspan="2" class="min-width-60">Sub-WO Num</th>
                                        <th rowspan="2" class="min-width-60">SO Num</th>
                                        <th rowspan="2">Site</th>
                                        <th rowspan="2">Warehouse</th>
                                        <th rowspan="2">Location</th>
                                        <th rowspan="2">Shelf</th>
                                        <th rowspan="2">Bin</th>
                                        <th rowspan="2" style="min-width:70px !important">Is Active</th>
                                        <th rowspan="2" style="min-width:70px !important">Is Deleted</th>
                                        <th rowspan="2" class="min-width-250">Memo</th>
                                        <th rowspan="2">Created Date</th>
                                        <th rowspan="2">Created By</th>
                                        <th rowspan="2">Updated Date</th>
                                        <th rowspan="2">Updated By</th>
                                    </tr>
                                </thead>
                                <tbody *ngIf="auditHistoryList && auditHistoryList.length > 0">
                                    <tr *ngFor="let audit of auditHistoryList; let i = index">
                                        <td
                                            [ngStyle]="{color: getColorCodeForHistory(i, 'taskName', audit.taskName) ? 'black' : 'red'}">
                                            {{ audit.taskName }}</td>
                                        <td
                                            [ngStyle]="{color: getColorCodeForHistory(i, 'partNumber', audit.partNumber) ? 'black' : 'red'}">
                                            {{ audit.partNumber }}</td>
                                        <td
                                            [ngStyle]="{color: getColorCodeForHistory(i, 'partDescription', audit.partDescription) ? 'black' : 'red'}">
                                            {{ audit.partDescription }}</td>
                                        <td
                                            [ngStyle]="{color: getColorCodeForHistory(i, 'serialNumber', audit.serialNumber) ? 'black' : 'red'}">
                                            {{ audit.serialNumber }}</td>
                                        <td
                                            [ngStyle]="{color: getColorCodeForHistory(i, 'condition', audit.condition) ? 'black' : 'red'}">
                                            {{ audit.condition }}</td>
                                        <td
                                            [ngStyle]="{color: getColorCodeForHistory(i, 'stockLineNumber', audit.stockLineNumber) ? 'black' : 'red'}">
                                            {{ audit.stockLineNumber }}</td>
                                        <td
                                            [ngStyle]="{color: getColorCodeForHistory(i, 'mandatoryOrSupplemental', audit.mandatoryOrSupplemental) ? 'black' : 'red'}">
                                            {{ audit.mandatoryOrSupplemental }}</td>
                                        <td
                                            [ngStyle]="{color: getColorCodeForHistory(i, 'provision', audit.provision) ? 'black' : 'red'}">
                                            {{ audit.provision }}</td>
                                        <!-- <td [ngStyle]="{color: getColorCodeForHistory(i, 'provision', audit.provision) ? 'black' : 'red'}">{{ audit.provision }}</td> -->
                                        <td [ngStyle]="{color: getColorCodeForHistory(i, 'qunatityRequried', audit.qunatityRequried) ? 'black' : 'red'}"
                                            class="text-right">{{ audit.qunatityRequried }}</td>
                                        <td [ngStyle]="{color: getColorCodeForHistory(i, 'qunatityReserved', audit.qunatityReserved) ? 'black' : 'red'}"
                                            class="text-right">{{ audit.qunatityReserved }}</td>
                                        <td [ngStyle]="{color: getColorCodeForHistory(i, 'quantityIssued', audit.quantityIssued) ? 'black' : 'red'}"
                                            class="text-right">{{ audit.quantityIssued }}</td>
                                        <td [ngStyle]="{color: getColorCodeForHistory(i, 'qunatityTurnIn', audit.qunatityTurnIn) ? 'black' : 'red'}"
                                            class="text-right">{{ audit.qunatityTurnIn }}</td>
                                        <td class="min-w-100"
                                            [ngStyle]="{color: getColorCodeForHistory(i, 'partQuantityOnHand', audit.partQuantityOnHand) ? 'black' : 'red'}"
                                            class="text-right">{{ audit.partQuantityOnHand }}</td>
                                        <td class="min-w-100"
                                            [ngStyle]="{color: getColorCodeForHistory(i, 'partQuantityAvailable', audit.partQuantityAvailable) ? 'black' : 'red'}"
                                            class="text-right">{{ audit.partQuantityAvailable }}</td>
                                        <td class="min-w-100"
                                            [ngStyle]="{color: getColorCodeForHistory(i, 'qunatityRemaining', audit.qunatityRemaining) ? 'black' : 'red'}"
                                            class="text-right">{{ audit.qunatityRemaining }}</td>
                                        <td class="min-w-100"
                                            [ngStyle]="{color: getColorCodeForHistory(i, 'uom', audit.uom) ? 'black' : 'red'}">
                                            {{ audit.uom }}</td>
                                        <td
                                            [ngStyle]="{color: getColorCodeForHistory(i, 'stockType', audit.stockType) ? 'black' : 'red'}">
                                            {{ audit.stockType }}</td>
                                        <td
                                            [ngStyle]="{color: getColorCodeForHistory(i, 'itemClassification', audit.itemClassification) ? 'black' : 'red'}">
                                            {{ audit.itemClassification }}</td>
                                        <td [ngStyle]="{color: getColorCodeForHistory(i, 'partQuantityOnOrder', audit.partQuantityOnOrder) ? 'black' : 'red'}"
                                            class="text-right">{{ audit.partQuantityOnOrder }}</td>
                                        <td [ngStyle]="{color: getColorCodeForHistory(i, 'qunatityBackOrder', audit.qunatityBackOrder) ? 'black' : 'red'}"
                                            class="text-right">{{ audit.qunatityBackOrder }}</td>
                                        <td
                                            [ngStyle]="{color: getColorCodeForHistory(i, 'needDate', audit.needDate) ? 'black' : 'red'}">
                                            {{ audit.needDate | date: 'MM/dd/yyyy h:mm a ' }}</td>
                                        <td
                                            [ngStyle]="{color: getColorCodeForHistory(i, 'controlNo', audit.controlNo) ? 'black' : 'red'}">
                                            {{ audit.controlNo }}</td>
                                        <td
                                            [ngStyle]="{color: getColorCodeForHistory(i, 'controlId', audit.controlId) ? 'black' : 'red'}">
                                            {{ audit.controlId }}</td>
                                        <td
                                            [ngStyle]="{color: getColorCodeForHistory(i, 'currency', audit.currency) ? 'black' : 'red'}">
                                            {{ audit.currency }}</td>
                                        <td [ngStyle]="{color: getColorCodeForHistory(i, 'unitCost', audit.unitCost) ? 'black' : 'red'}"
                                            class="text-right">{{ audit.unitCost }}</td>
                                        <td [ngStyle]="{color: getColorCodeForHistory(i, 'extendedCost', audit.extendedCost) ? 'black' : 'red'}"
                                            class="text-right">{{ audit.extendedCost }}</td>
                                        <td
                                            [ngStyle]="{color: getColorCodeForHistory(i, 'costDate', audit.costDate) ? 'black' : 'red'}">
                                            {{ audit.costDate | date: 'MM/dd/yyyy h:mm a '}}</td>
                                        <td
                                            [ngStyle]="{color: getColorCodeForHistory(i, 'purchaseOrderNumber', audit.purchaseOrderNumber) ? 'black' : 'red'}">
                                            {{ audit.purchaseOrderNumber }}</td>
                                        <td
                                            [ngStyle]="{color: getColorCodeForHistory(i, 'repairOrderNumber', audit.repairOrderNumber) ? 'black' : 'red'}">
                                            {{ audit.repairOrderNumber }}</td>
                                        <td
                                            [ngStyle]="{color: getColorCodeForHistory(i, 'receiver', audit.receiver) ? 'black' : 'red'}">
                                            {{ audit.receiver }}</td>
                                        <td
                                            [ngStyle]="{color: getColorCodeForHistory(i, 'workOrderNumber', audit.workOrderNumber) ? 'black' : 'red'}">
                                            {{ audit.workOrderNumber }}</td>
                                        <td
                                            [ngStyle]="{color: getColorCodeForHistory(i, 'subWorkOrderNo', audit.subWorkOrderNo) ? 'black' : 'red'}">
                                            {{ audit.subWorkOrderNo }}</td>
                                        <td
                                            [ngStyle]="{color: getColorCodeForHistory(i, 'salesOrder', audit.salesOrder) ? 'black' : 'red'}">
                                            {{ audit.salesOrder }}</td>
                                        <td
                                            [ngStyle]="{color: getColorCodeForHistory(i, 'site', audit.site) ? 'black' : 'red'}">
                                            {{ audit.site }}</td>
                                        <td
                                            [ngStyle]="{color: getColorCodeForHistory(i, 'wareHouse', audit.wareHouse) ? 'black' : 'red'}">
                                            {{ audit.wareHouse }}</td>
                                        <td
                                            [ngStyle]="{color: getColorCodeForHistory(i, 'location', audit.location) ? 'black' : 'red'}">
                                            {{ audit.location }}</td>
                                        <td
                                            [ngStyle]="{color: getColorCodeForHistory(i, 'shelf', audit.shelf) ? 'black' : 'red'}">
                                            {{ audit.shelf }}</td>
                                        <td class="min-w-100"
                                            [ngStyle]="{color: getColorCodeForHistory(i, 'bin', audit.bin) ? 'black' : 'red'}">
                                            {{ audit.bin }}</td>
                                        <td>
                                            <input type="checkbox" disabled [checked]="audit.isActive == true"
                                                style="margin: 0px auto; display: block;" />
                                        </td>
                                        <td>
                                            <input type="checkbox" disabled [checked]="audit.isDeferred == true"
                                                style="margin: 0px auto; display: block;" />
                                        </td>
                                        <td class="min-width-250"
                                            [ngStyle]="{color: getColorCodeForHistory(i, 'memo', audit.memo) ? 'black' : 'red'}">
                                            <p class="p_editor  truncate-text" matTooltipPosition="above"
                                                [matTooltip]="parsedText(audit.memo)" [innerHTML]="audit.memo"></p>
                                        </td>
                                        <td>{{ audit.createdDate | date: 'MM/dd/yyyy h:mm a ' }}</td>
                                        <td>{{ audit.createdBy }}</td>
                                        <td
                                            [ngStyle]="{color: getColorCodeForHistory(i, 'updatedDate', audit.updatedDate) ? 'black' : 'red'}">
                                            {{ audit.updatedDate | date: 'MM/dd/yyyy h:mm a '}}</td>
                                        <td class="min-w-100"
                                            [ngStyle]="{color: getColorCodeForHistory(i, 'updatedBy', audit.updatedBy) ? 'black' : 'red'}">
                                            {{ audit.updatedBy }}</td>
                                    </tr>
                                </tbody>
                            </ng-container>
                        </table>
                    </div>
                    <ng-template *ngIf="auditHistoryList && auditHistoryList.length==0">
                        
                            <div class="text-center">
                                <img src="../../../assets/images/binoculars.png" class="no-history-found-image">
                                <h4 class="no-history-found-msg">No History Found </h4>
                            </div>
                      
                    </ng-template>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-danger history-close-button" data-dismiss="modal" type="button">Close</button>
            </div>
        </div>
       
    </div>
</div>
<div class="preloader" *ngIf="isSpinnerVisible">
    <div class="loading">
        <div class="lds-roller">
            <div></div>
            <div></div>
            <div></div>
            <div></div>
            <div></div>
            <div></div>
            <div></div>
            <div></div>
        </div>
    </div>
</div> 
<div *ngIf="!ispickticket">
    <div [ngClass]="(isView == false) ? 'table-responsive pas-table-cstm rro-part-table-cstm poro-table-cstm parts-list-table-align parts-zindex' : 'table-responsive pas-table-cstm poro-table-cstm parts-list-table-align parts-zindex'"
        style="min-height: 130px !important;">
        <p-table   class=" rpo-table-cstm rro-table-cstm materialListTable" id="custome_material"
            [columns]="summaryColumns" #materialTble [value]="workOrderMaterialList" [paginator]="true"
            [rows]="pageSize"  selectionMode="multiple"  [reorderableColumns]="true" [metaKeySelection]="true" [rowsPerPageOptions]="[5, 10, 20,50, 100,200,500]" (onPage)="pageIndexChange($event)">
            <ng-template pTemplate="caption">
            <div class="row">
                <div class="col">
              <button  type="button"
                        class="btn btn-primary exp_btn"
                        matTooltip="Download Data"
                        matTooltipPosition="above"
                        pButton
                        icon="fa-download"
                        iconPos="left"
                        label="Export Parent"
                        data-toggle="modal"
                        (click)="isMaterial = true; targetData = materialTble;" 
                        data-target="#downloadConfirmation"
                      ></button>
                      <button
                        type="button"
                        class="btn btn-primary exp_btn"
                        matTooltip="Download Selected Data"
                        matTooltipPosition="above"
                        pButton
                        icon="fa-download"
                        iconPos="left"
                        data-target="#downloadConfirmation"
                        data-toggle="modal"
                        label="Export Stk Lines"
                        (click)="isMaterial = false; targetData = materialTble;"></button>   
             
             
                    </div>
           </div>

           
<div class="modal fade" id="downloadConfirmation" role="dialog" data-backdrop="static" data-keyboard="false">
	<div class="modal-dialog modal-sm">
		<div class="modal-content ">
			<div class="modal-header text_st">
				<button type="button" class="close close_export" (click)="closeDeleteModal()">&times;</button>
				<h4 class="modal-title text_st">Are You Sure Want to Download?</h4>
			</div>
			<div class="modal-body text_st" *ngIf="targetData">
				<strong>
					<span *ngIf="!selectedOnly">
                        <!-- {{targetData.totalRecords}} of -->
						You are attempting to export  records. 
					</span> 
				</strong>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-primary" (click)="exportCSV(targetData,isMaterial); closeDeleteModal();">Confirm</button>
				<button type="button" class="btn btn-danger" (click)="closeDeleteModal()">Cancel</button>
			</div>
		</div>
	</div>
</div>
        </ng-template>
            <ng-template pTemplate="header" let-columns>
                <tr>
                    <th class="table-column-width" [ngStyle]="{'width': col.width}"
                        [ngClass]="{'adj_width1': col.header=='PN','adj_width2': (col.header=='PN Description') }"
                        *ngFor="let col of columns">
                        {{col.header}}
                    </th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <!-- <th></th> -->
                    <!-- <th></th> -->
                    <!-- <th></th> -->
                    <!-- <th></th> -->
                    <!-- <th></th> -->
                    <!-- *ngIf="(fromWoList ==false || fromWoList ==undefined) && !isView" -->
                    <th class="table-actions-column"
                         [ngClass]="(isView == false) ? 'width-170' : 'width-80'">Actions </th>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-rowData let-i="rowIndex" let-columns="columns"  >
                <tr class="ui-widget-header" [pReorderableRow]="i" [pSelectableRow]="rowData" pReorderableRowHandle>
                    <td class="summary-column" *ngFor="let col of columns">
                        <input type="checkbox" name="contract {{i}}" #contract="ngModel"
                            *ngIf="col.field =='isFromWorkFlow'" class="form-control w60 defered-check"
                            [(ngModel)]="rowData.isFromWorkFlow" disabled>
                        <p *ngIf="col.field !='line' && col.field !='unitCost' && col.field !='memo' && col.field !='isDeferred'&& col.field !='isFromWorkFlow' && col.field !='stockLineNumber' && col.field !='controlNo' && col.field !='controlId' && col.field !='receiver' && col.field !='altEquiv' "
                            style="margin:0px !important" [ngClass]="{align_rightset : (col && col.align ==1)}">
                            {{rowData[col.field]}}</p>
                        <p *ngIf="col.field =='line' && col.field !='memo' && col.field !='isDeferred'&& col.field !='isFromWorkFlow' && col.field !='stockLineNumber' && col.field !='controlNo' && col.field !='controlId' && col.field !='receiver'"
                            style="margin:0px !important" class=" p-0 text-center"
                            [ngClass]="{align_rightset : (col && col.align ==1)}"> {{i + 1}}</p>
                        <p *ngIf="col.field =='stockLineNumber' " [matTooltip]="rowData.stockLineNumber"
                            [matTooltipDisabled]="rowData.isMultipleStockLine == 'Single'" matTooltipPosition="above"
                            style="margin:0px !important" [ngClass]="{align_rightset : (col && col.align ==1)}"> {{
                            rowData.isMultipleStockLine== 'Single' ? rowData[col.field] : rowData.isMultipleStockLine}}
                        </p>
                        <p *ngIf=" col.field =='controlNo'" [matTooltip]="rowData.controlNo"
                            [matTooltipDisabled]="rowData.isMultipleControlNo == 'Single'" matTooltipPosition="above"
                            style="margin:0px !important" [ngClass]="{align_rightset : (col && col.align ==1)}">
                            {{rowData.isMultipleControlNo== 'Single' ? rowData[col.field] : rowData.isMultipleControlNo
                            }}</p>
                        <p *ngIf=" col.field =='controlId'" [matTooltip]="rowData.controlId"
                            [matTooltipDisabled]="rowData.isMultiplecontrolId == 'Single'" matTooltipPosition="above"
                            style="margin:0px !important" [ngClass]="{align_rightset : (col && col.align ==1)}"> {{
                            rowData.isMultiplecontrolId== 'Single' ? rowData[col.field] : rowData.isMultiplecontrolId }}
                        </p>
                        <p *ngIf=" col.field =='receiver'" [matTooltip]="rowData.receiver"
                            [matTooltipDisabled]="rowData.isMultiplereceiver == 'Single'" matTooltipPosition="above"
                            style="margin:0px !important" [ngClass]="{align_rightset : (col && col.align ==1)}"> {{
                            rowData.isMultiplereceiver== 'Single' ? rowData[col.field] : rowData.isMultiplereceiver }}
                        </p>
                        <p *ngIf="col.field =='altEquiv'" style="margin:0px !important">{{rowData.isAltPart ?
                            'Alternative' : rowData.isEquPart ? 'Equivalent' : '-'}}</p>
                        <p *ngIf="col.field =='unitCost'" style="margin:0px !important" [ngClass]="{align_rightset : (col && col.align ==1)}">
                            <span *ngIf="rowData && rowData.childParts && rowData.childParts.length>1">Multiple</span>
                            <span *ngIf="rowData && rowData.childParts && rowData.childParts.length<=1">
                                {{rowData[col.field]}} </span>
                        </p>

                        <input type="checkbox" name="contract {{i}}" #contract="ngModel"
                            *ngIf="col.field =='isDeferred'" class="form-control w60 defered-check"
                            [(ngModel)]="rowData.isDeferred">
                        <span *ngIf="col.field =='memo'" [innerHTML]="rowData[col.field]"
                            class="p_textEditor truncate-text" matTooltipPosition="above"
                            [matTooltip]="parsedText(rowData[col.field])"></span>
                    </td>
                    <td class="summary-column"></td>
                    <td class="summary-column"></td>
                    <td class="summary-column"></td>
                    <!-- <td class="summary-column"></td> -->
                    <!-- <td class="summary-column"></td> -->
                    <!-- <td class="summary-column"></td> -->
                    <!-- <td class="summary-column"></td> -->
                    <!-- <td class="summary-column"></td> -->
                    <td class="action-icons-cstm  lastcol-fix"
                        style="position: sticky !important; min-width: 145px !important;width: 160px !important;text-align:center !important"
                       >
                       <!-- *ngIf="(fromWoList ==false || fromWoList ==undefined) && !isView" -->
                        <span *ngIf="!isView"><button class="btn nobg btn-edit-cstm1" (click)="editNew(rowData)" matTooltip="Edit"
                                matTooltipPosition="above"><i class="fa fa-pencil"></i></button></span>
                        <span>
                            <button class="btn nobg btn-view-cstm" (click)="viewItem(rowData)" matTooltip="View Inventory"
                                matTooltipPosition="above">
                                <i class="fa fa-eye"></i> </button>
                        </span>
                        <span *ngIf="!isView"><button type="button" class="btn nobg btn-pluspo-cstm"
                                (click)="createNewPoWorkOrder(rowData)" *ngIf="rowData.isRoleUp==false"
                                matTooltip="Create PO" matTooltipPosition="above"><i
                                    class="fa fa-plus create_po_crl"></i></button></span>
                        <span *ngIf="!isSubWorkOrder && !isView">
                            <button class="btn nobg" mat-icon-button
                                (click)="pickticketItemInterface(rowData,pickticketieminterface)"
                                matTooltip="Create Pick Ticket" matTooltipPosition="above" style="font-weight: bold;"
                                [disabled]="!(rowData.partStatusId >0)">
                                <i class="fa fa-plus" [ngClass]="{'btn_disabled':!(rowData.partStatusId >0)}"></i>
                            </button>
                        </span>
                        <span *ngIf="!isSubWorkOrder && rowData.provision=='Sub Work Order' && !isView">
                            <button type="button" class="btn nobg btn-pluspo-cstm" *ngIf="rowData.subWorkOrderId == 0"
                                (click)="subWoClick(rowData)"
                                [matTooltip]="rowData.subWorkOrderId ==0 ? 'Create Sub Work Order' : 'Edit Sub Work Order'"
                                matTooltipPosition="above"
                                [disabled]="!(rowData.partStatusId ==enumPartStatus.Issued  || rowData.partStatusId ==enumPartStatus.Reserveandissued)">   
                                <i class="fa fa-plus grn_clr"
                                    [ngClass]="{'btn_disabled':!(rowData.partStatusId ==enumPartStatus.Issued || rowData.partStatusId ==enumPartStatus.Reserveandissued )}"></i>
                            </button>
                            <button type="button" class="btn nobg btn-pluspo-cstm" *ngIf="rowData.subWorkOrderId != 0"
                                (click)="editSubWo(rowData)"
                                [matTooltip]="rowData.subWorkOrderId ==0 ? 'Create Sub Work Order' : 'Edit Sub Work Order'"
                                matTooltipPosition="above">
                                <i class="fa fa-pencil grn_clr"></i>
                            </button>
                        </span>
                        <span *ngIf="!isSubWorkOrder && rowData.provision !='Sub Work Order' && !isView">
                            <button type="button" class="btn nobg btn-pluspo-cstm" disabled>
                                <i class="fa fa-plus" style="color: #b7b7b7;"></i>
                            </button>
                        </span>
                        <span *ngIf="!isView"><button type="button" class="btn nobg btn-delete-cstm" *ngIf="rowData.isRoleUp==false;"
                                (click)="openDelete(content,rowData)"
                                [ngClass]="{'btn_disabled': (rowData.quantityIssued!=0 || rowData.quantityReserved!=0)}"
                                [disabled]="rowData.quantityIssued!=0 || rowData.quantityReserved !=0"
                                matTooltip="Remove" matTooltipPosition="above"><i class="fa fa-trash"></i></button>
                        </span>
                        <span data-toggle="modal" data-target="#materialAudit"><button
                            [ngClass]="(isView == false) ? 'btn nobg btn-hist-cstm' : 'btn nobg btn-hist-cstm'"
                           
                                (click)="openMaterialAudit(rowData)" matTooltip="Material List History"
                                matTooltipPosition="above"><i class="fa fa-history"></i></button></span>
                                <!-- class="btn nobg btn-hist-cstm mr-top5" -->
                    </td>
                </tr>
                <tr class="child-header splitship-head child-header-back">
                    <td class="custom_Tdth" *ngFor="let childcol of childColumnsData"
                        [ngStyle]="{'min-width': childcol.width}" style="text-align: center !important;">
                        {{childcol.header}}
                    </td>
                    <td   class="lastcol-fix"
                        style="position: sticky !important; min-width: 145px !important; width:80px"></td>
                </tr> 
                <tr class="child-data splitship-child child-data-back " pReorderableRowHandle [pSelectableRow]="rowData"  
                    *ngFor="let childRowData of rowData.childParts; let stockIndex1 = index">
                    <td *ngFor="let childcol of childColumnsData; let i = index" class="summary-column"
                        pReorderableRowHandle>
                        <input type="checkbox" name="contract" #contract="ngModel"
                            *ngIf="childcol.field =='isFromWorkFlow'" class="form-control w60 defered-check2"
                            [(ngModel)]="childRowData.isFromWorkFlow" disabled>
                        <p *ngIf="childcol.field !='line' && childcol.field !='memo' && childcol.field !='isDeferred'&& childcol.field !='isFromWorkFlow' && childcol.field !='stockLineNumber' && childcol.field !='controlNo' && childcol.field !='controlId' && childcol.field !='receiver' && childcol.field !='altEquiv'  && childcol.field !='showempty'"
                            style="margin:0px !important"
                            [ngClass]="{align_rightset : (childcol && childcol.align ==1)}">
                            {{childRowData[childcol.field]}}</p>
                        <p *ngIf="childcol.field =='line' && childcol.field !='memo' && childcol.field !='isDeferred'&& childcol.field !='isFromWorkFlow' && childcol.field !='stockLineNumber' && childcol.field !='controlNo' && childcol.field !='controlId' && childcol.field !='receiver' && childcol.field !='showempty'"
                            style="margin:0px !important" class=" p-0 text-center"
                            [ngClass]="{align_rightset : (childcol && childcol.align ==1)}">
                            {{childRowData[childcol.field]}} </p>
                        <p *ngIf="childcol.field =='stockLineNumber' " [matTooltip]="childRowData.stockLineNumber"
                            [matTooltipDisabled]="childRowData.isMultipleStockLine == 'Single'"
                            matTooltipPosition="above" style="margin:0px !important"
                            [ngClass]="{align_rightset : (childcol && childcol.align ==1)}"> {{
                            childRowData.isMultipleStockLine== 'Single' ? childRowData[childcol.field] :
                            childRowData.isMultipleStockLine}}</p>
                        <p *ngIf=" childcol.field =='controlNo'" [matTooltip]="childRowData.controlNo"
                            [matTooltipDisabled]="childRowData.isMultipleControlNo == 'Single'"
                            matTooltipPosition="above" style="margin:0px !important"
                            [ngClass]="{align_rightset : (childcol && childcol.align ==1)}">
                            {{childRowData.isMultipleControlNo== 'Single' ? childRowData[childcol.field] :
                            childRowData.isMultipleControlNo }}</p>
                        <p *ngIf=" childcol.field =='controlId'" [matTooltip]="childRowData.controlId"
                            [matTooltipDisabled]="childRowData.isMultiplecontrolId == 'Single'"
                            matTooltipPosition="above" style="margin:0px !important"
                            [ngClass]="{align_rightset : (childcol && childcol.align ==1)}"> {{
                            childRowData.isMultiplecontrolId== 'Single' ? childRowData[childcol.field] :
                            childRowData.isMultiplecontrolId }}</p>
                        <p *ngIf=" childcol.field =='receiver'" [matTooltip]="childRowData.receiver"
                            [matTooltipDisabled]="childRowData.isMultiplereceiver == 'Single'"
                            matTooltipPosition="above" style="margin:0px !important"
                            [ngClass]="{align_rightset : (childcol && childcol.align ==1)}"> {{
                            childRowData.isMultiplereceiver== 'Single' ? childRowData[childcol.field] :
                            childRowData.isMultiplereceiver }}</p>
                        <p *ngIf="childcol.field =='altEquiv'" style="margin:0px !important">{{childRowData.isAltPart ?
                            'Alternative' : childRowData.isEquPart ? 'Equivalent' : '-'}}</p>
                        <p *ngIf="childcol.field =='showempty'" style="margin:0px !important"> -</p>
                        <input type="checkbox" name="contract" #contract="ngModel" *ngIf="childcol.field =='isDeferred'"
                            class="form-control w60 defered-check3" [(ngModel)]="childRowData.isDeferred">
                        <span *ngIf="childcol.field =='memo'" [innerHTML]="childRowData[childcol.field]"
                            class="p_textEditor truncate-text" matTooltipPosition="above"
                            [matTooltip]="parsedText(childRowData[childcol.field])"></span>
                    </td>
                    <td  class="action-icons-cstm  lastcol-fix"
                     style="position: sticky !important; min-width: 145px !important; width:80px;text-align:center !important">
  
                        <span *ngIf="!isView"><button class="btn nobg btn-edit-cstm1"
                             [disabled]="childRowData.stocklineQtyIssued!=0 || childRowData.stocklineQtyReserved !=0" 
                             (click)="editStockLine(childRowData,rowData)" matTooltip="Edit" matTooltipPosition="above" >
                             <i  class="fa fa-pencil"></i></button></span>
                        <span style="margin-left:-4px">
                            <button class="btn nobg btn-view-cstm" data-toggle="tooltip"
                                (click)="viewStockSelectedRow(childRowData)" matTooltip="View This StkLine">
                                <i class="fa fa-eye"></i>
                        </button>
                        </span>
                        <span *ngIf="!isView"><button type="button" class="btn nobg btn-delete-cstm"
                                [disabled]="childRowData.stocklineQtyIssued!=0 || childRowData.stocklineQtyReserved !=0"
                                (click)="deleteStockLine(Stockcontent,childRowData)" matTooltip="Remove"
                                matTooltipPosition="above"><i class="fa fa-trash"></i></button> </span>
                        <!-- <span><button type="button" class="btn nobg btn-pluspo-cstm"
                                (click)="createNewROWorkOrder(childRowData,rowData)" *ngIf="rowData.isRoleUp == false && rowData.provision == 'REPAIR'"
                                matTooltip="Create RO" matTooltipPosition="above"><i
                                    class="fa fa-plus"></i></button></span> -->
                    </td>
                </tr>
                <tr class="child-data splitship-child child-data-back "
                    *ngIf="rowData.childParts && rowData.childParts.length==0">
                    <td colspan="49" class="no-recordscusMsg"
                        style="background: #fff !important;padding: 3px !important;padding-left:13%  !important;text-transform: capitalize;">
                        No Stockline Available
                    </td>
                </tr>
            </ng-template>
            <ng-template pTemplate="emptymessage" let-columns>
                <tr>
                    <td colspan="49" class="no-records-cstm no-records-msg" style="margin-left:-36%">
                        No records found
                    </td>
                </tr>
            </ng-template>
            <ng-template pTemplate="summary" id="footer">
                <label id="footer" class="footer" style="background: #fff !important;">Total:</label>
                <input class="footer-input-width" [(ngModel)]="materialTble._totalRecords" [disabled]="true" pInputText
                    type="text" />
                &nbsp;&nbsp;
                <label id="footer" class="footer1">Pages Count:</label>
                <input class="footer-input-width" [ngModel]="
        getPageCount(materialTble._totalRecords, pageSize)
      " [disabled]="true" pInputText type="text" />
            </ng-template>
        </p-table>
        <div class="modal fade" id="showStockLineDetails" role="dialog" data-backdrop="static" data-keyboard="false">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header" style="text-align: start;">
                        <button type="button" class="close" (click)="onCloseMaterial(1)">&times;</button>
                        <h4 class="modal-title">Edit PN Details</h4>
                    </div>
                    <div class="modal-body" *ngIf="editData !=undefined">
                        <app-wo-margin tabindex="-1" [isStockView]="isStockView" [isSubWorkOrder]="isSubWorkOrder"
                            [isStockLine]="isStockLine" (close)="onCloseMaterial($event)"
                            (setmaterialListForUpdate)="setmaterialListForUpdate($event)" [isEdit]="isEdit"
                            [editData]="editData" [part]="editData" [isEdit]="isEdit"
                            (save)="openSalesMarginSave($event)"></app-wo-margin>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<ng-template #pickticketieminterface let-c="close" let-d="dismiss">
    <div class="modal-header">
        <button type="button" class="close font_chck" (click)="dismissModel()">
            &times;
        </button>
        <h4 class="modal-title">Pick Item</h4>
    </div>
    <div class="modal-body">
        <form #ptiteminterface="ngForm" class="form-horizontal">
            <p-table #dt [value]="parts" class="rpo-table-cstm ptable-custom pickticket"
                [columns]="pickTicketItemInterfaceheader" [scrollable]="true" [resizableColumns]="true"
                selectionMode="single" [responsive]="true" [metaKeySelection]="true" [style]="{ width: '100%' }">
                <ng-template pTemplate="colgroup" let-columns>
                    <colgroup>
                        <col [ngStyle]="{'width': '50px'}" />
                        <col *ngFor="let col of pickTicketItemInterfaceheader"  [ngStyle]="{'width': col.width}" />
                    </colgroup>
                </ng-template>
                <ng-template pTemplate="header" let-columns>
                    <tr>
                        <th class="text-left">
                        </th>
                        <th *ngFor="let col of pickTicketItemInterfaceheader" [ngStyle]="{'width': col.width}">
                            {{col.header}}
                        </th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-part let-rowData let-i="rowIndex" let-columns="columns">
                    <tr pReorderableRowHandle>
                        <td>
                            <span>
                                <p-checkbox [(ngModel)]="rowData.isSelected" name="isSelected{{i}}"
                                    (onChange)="onChangeOfPartSelection($event)" [disabled]="!(rowData.qtyToShip >0)"  binary="true">
                                </p-checkbox>
                            </span>
                        </td>
                        <td *ngFor="let col of pickTicketItemInterfaceheader" pReorderableRowHandle>
                            <ng-container *ngIf="col.field != 'qtyToShip'">
                                {{part[col.field]}}
                            </ng-container>
                            <ng-container *ngIf="col.field =='qtyToShip'">
                                <input type="number" class="form-control quantityTextBox text-right" pInputText
                                    pKeyFilter="num" required="col.field =='qtyToReserve'" name="qtyToReserve{{i}}"
                                    value="{{part.qtyToReserve}}" [(ngModel)]="part.qtyToShip" (keyup)="checkValid(rowData)" (focusout)="onFocusOutEvent(rowData)"
                                    [disabled]="rowData.isSelected == false" required="col.field =='qtyToShip'" />
                            </ng-container>
                        </td>
                    </tr>
                </ng-template>
                <ng-template pTemplate="emptymessage" let-columns *ngIf="parts.length == 0">
                    <tr>
                        <td [attr.colspan]="18" class="no-records-cstm" style="text-align: left;">
                            No records found
                        </td>
                    </tr>
                </ng-template>
            </p-table>
            <div class="modal-footer">
                <button type="submit" (click)="savepickticketiteminterface(parts)" class="btn btn-primary"
                    [disabled]="!ptiteminterface.valid || disableSubmitButton == true">
                    {{ isEdit ? 'Update' : 'Save' }}
                </button>
                <button type="button" (click)="dismissModel()" class="btn btn-danger">
                    Close
                </button>
            </div>
        </form>
    </div>
</ng-template>