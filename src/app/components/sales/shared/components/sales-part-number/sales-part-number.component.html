<div class="form-group">
    <div [ngClass]="(isViewMode == false) ? 'row' : 'row ui-tabview-panels'" class="padding-bottom-8">
        <button *ngIf="isViewMode == false" type="button" class="btn btn-primary" (click)="addPartNumber()"
            [disabled]="salesQuote.isApproved">
            Add PN
        </button>
        <div [ngClass]="(isViewMode == false) ? 'table-responsive pas-table-cstm rro-part-table-cstm poro-table-cstm parts-list-table-align parts-zindex' : 'table-responsive pas-table-cstm poro-table-cstm parts-list-table-align parts-zindex'"
            style="min-height: 130px !important;">
            <div class="tableFixHead">
                <table class="table table-bordered" id="soq-table">
                    <tr class="font-size-10">
                        <th *ngFor="let summaryColumn of summaryColumns" [ngStyle]="{'min-width': summaryColumn.width}">
                            <ng-container *ngIf="summaryColumn.field == 'quantityToBeQuoted'
                                     || summaryColumn.field == 'customerRef'
                                     || summaryColumn.field == 'quantityRequested'">
                                {{ summaryColumn.header }}
                            </ng-container>
                            <ng-container *ngIf="summaryColumn.field != 'quantityToBeQuoted' 
                                && summaryColumn.field != 'customerRef'
                                    && summaryColumn.field != 'quantityRequested'">
                                {{ summaryColumn.header }}
                            </ng-container>
                        </th>
                        <th colspan="11"></th>
                        <th *ngIf="isViewMode == false" class="sales-part-action-column">Actions
                        </th>
                    </tr>
                    <ng-container *ngIf="summaryParts.length > 0">
                        <ng-container *ngFor="let summaryPart of summaryParts;let rowIndex=index;">
                            <tbody>
                                <tr ngClass="'row-bg1'" pReorderableRowHandle>
                                    <td *ngFor="let summaryColumn of summaryColumns" class="summary-column"
                                        pReorderableRowHandle>
                                        <span class="text-center" style="display: block;"
                                            *ngIf="summaryColumn.field == 'itemNo'">
                                            {{summaryPart[summaryColumn.field] }}
                                        </span>
                                        <span class="float-right" *ngIf="summaryColumn.field == 'fixRate'">
                                            {{summaryPart[summaryColumn.field] | twoDecimalGlobalNumberFormatPipe : '1.5'}}
                                        </span>
                                        <span *ngIf="summaryColumn.field != 'itemNo'
                                            && summaryColumn.field != 'quantityRequested'
                                            && summaryColumn.field != 'quantityToBeQuoted'
                                            && summaryColumn.field != 'quantityAlreadyQuoted'
                                            && summaryColumn.field != 'quantityAvailable'
                                            && summaryColumn.field != 'qtyOnHand'
                                            && summaryColumn.field != 'fixRate'
                                            && summaryColumn.field != 'grossSalePrice'
                                            && summaryColumn.field != 'salesDiscountExtended'
                                            && summaryColumn.field != 'netSalesPriceExtended'
                                            && summaryColumn.field != 'misc'
                                            && summaryColumn.field != 'freight'
                                            && summaryColumn.field != 'taxAmount'
                                            && summaryColumn.field != 'totalSales'
                                            && summaryColumn.field != 'unitCostExtended'
                                            && summaryColumn.field != 'marginAmountExtended'
                                            && summaryColumn.field != 'marginPercentageExtended'">
                                            {{summaryPart[summaryColumn.field]}}
                                        </span>
                                        <span class="float-right" *ngIf="summaryColumn.field == 'quantityRequested'
                                            || summaryColumn.field == 'quantityToBeQuoted'
                                            || summaryColumn.field == 'quantityAlreadyQuoted'
                                            || summaryColumn.field == 'quantityAvailable'
                                            || summaryColumn.field == 'qtyOnHand'">
                                            {{summaryPart[summaryColumn.field] | globalNmberFormat}}
                                        </span>
                                        <span class="float-right" *ngIf="summaryColumn.field == 'grossSalePrice'
                                            || summaryColumn.field == 'salesDiscountExtended'
                                            || summaryColumn.field == 'netSalesPriceExtended'
                                            || summaryColumn.field == 'misc'
                                            || summaryColumn.field == 'freight'
                                            || summaryColumn.field == 'taxAmount'
                                            || summaryColumn.field == 'totalSales'
                                            || summaryColumn.field == 'unitCostExtended'
                                            || summaryColumn.field == 'marginAmountExtended'
                                            || summaryColumn.field == 'marginPercentageExtended'">
                                            {{summaryPart[summaryColumn.field] | twoDecimalGlobalNumberFormatPipe}}
                                        </span>
                                    </td>
                                    <td colspan="11" style="background-color: #EAF2C5 !important;"></td>
                                    <td *ngIf="isViewMode == false" class="center">
                                        <a [class.disabled]="salesQuote.isApproved || isViewMode"
                                            [ngClass]="{'btn_disabled': salesQuote.isApproved || isViewMode}"
                                            class="btn nobg" (click)="adjustQty(summaryPart,rowIndex)"
                                            matTooltip="Adjust Qty" matTooltipPosition="above">
                                            <i class="fa fa-cubes" style="color: #000;"></i>
                                        </a>
                                        <a class="btn nobg view-part-eye" (click)="viewPartNumber(summaryPart,rowIndex)"
                                            matTooltip="View Inventory" matTooltipPosition="above">
                                            <i class="fa fa-eye"></i>
                                        </a>
                                        <span *ngIf="summaryPart['methodType'] == 'S'">
                                            <a [class.disabled]="salesQuote.isApproved || isViewMode"
                                                [ngClass]="{'btn_disabled': salesQuote.isApproved || isViewMode}"
                                                class="btn nobg view-part-eye"
                                                (click)="addPartNumber(summaryPart,rowIndex)" matTooltip="Add StkLine"
                                                matTooltipPosition="above">
                                                <i class="fa fa-pencil"></i>
                                            </a>
                                        </span>
                                        <a [class.disabled]="salesQuote.isApproved || isViewMode"
                                            [ngClass]="{'btn_disabled': salesQuote.isApproved || isViewMode}"
                                            class="btn nobg"
                                            (click)="openmultiplepartDelete(summaryPart, rowIndex, deletepartcontent)"
                                            matTooltip="Remove" matTooltipPosition="above">
                                            <i class="fa fa-trash"></i>
                                        </a>
                                        <span>
                                            <a class="btn nobg btn-hist-cstm view-part-eye"
                                                (click)="openSOQSummary(contentSOQSummary, summaryPart)"
                                                matTooltip="SOQ History" matTooltipPosition="above"><i
                                                    class="fa fa-history"></i></a>
                                        </span>
                                    </td>
                                </tr>
                                <tr class="child-header splitship-head child-header-back">
                                    <th class="background-white"></th>
                                    <th>PN</th>
                                    <th>PN Description</th>
                                    <th>Priority<span class="clr-red">*</span></th>
                                    <th colspan="2">Cust Req Date<span class="clr-red">*</span></th>
                                    <th colspan="2">Cust Prmsd Date<span class="clr-red">*</span></th>
                                    <th colspan="2">Est Ship Date<span class="clr-red">*</span></th>
                                    <th>Cond</th>
                                    <th colspan="2">Stk Line Num</th>
                                    <th>Ser Num</th>
                                    <th>Quote Date</th>
                                    <th>Qty Avail</th>
                                    <th>Qty OH</th>
                                    <th>Qty Qted</th>
                                    <th>Qty Prev Qted</th>
                                    <th>Status</th>
                                    <!-- <th>Unit Cost</th>
                                    <th>MarkUp %</th>
                                    <th>MarkUp Amt/Unit</th>
                                    <th style="min-width: 94px;">Gross Price/Unit</th>
                                    <th style="min-width: 62px;">Disc. %</th>
                                    <th style="min-width: 90px;">Disc. Amt/Unit</th>
                                    <th style="min-width: 80px;">MarkUp Amt</th>
                                    <th style="min-width: 92px !important;">Gross Sales Amt</th>
                                    <th style="min-width: 60px !important;">Disc. Amt</th>
                                    <th style="min-width: 85px !important;">Net Sales Amt</th>
                                    <th style="min-width: 220px !important;">Tax Type & Rate</th>
                                    <th style="min-width: 55px !important;">Tax Amt</th>
                                    <th style="min-width: 45px !important;">Total</th>
                                    <th style="min-width: 85px !important;">Extended Cost</th>
                                    <th style="min-width: 92px !important;">Product Margin</th>
                                    <th style="min-width: 110px !important;">Product Margin (%)</th> -->
                                    <th>Per Unit</th>
                                    <th>Ext. Price</th>
                                    <th>Misc Charges</th>
                                    <th>Total Revenue</th>
                                    <th style="min-width: 80px !important;">Unit Cost</th>
                                    <th style="min-width: 80px !important;">Ext Cost</th>
                                    <th style="min-width: 85px !important;">Margin Amt</th>
                                    <th style="min-width: 85px !important;">Margin %</th>
                                    <th style="min-width: 75px !important;">Freight</th>
                                    <th style="min-width: 70px !important;">Tax Amt</th>
                                    <th style="min-width: 60px !important;">Stk Type</th>
                                    <th style="min-width: 92px !important;">Alt/Equiv</th>
                                    <th style="min-width: 80px !important;">Cntrl Num</th>
                                    <th style="min-width: 92px !important;">Cntrl ID Num</th>
                                    <th style="min-width: 120px">Notes</th>
                                    <th *ngIf="isViewMode == false"
                                        style="min-width: 120px; position: sticky !important">Actions</th>
                                </tr>
                                <tr class="child-data splitship-child child-data-back"
                                    *ngFor="let part of summaryPart.childParts; let stockIndex = index"
                                    [hidden]="part.isDeleted">
                                    <td class="text-center">
                                        {{(summaryPart['itemNo']) + '.' + (stockIndex + 1)}}
                                    </td>
                                    <td>
                                        {{ part.partNumber }}
                                    </td>
                                    <td>
                                        {{ part.description }}
                                    </td>
                                    <td *ngIf="isViewMode == true || isEditDisabled(salesQuote, part)">
                                        {{ part.priorityName }}
                                    </td>
                                    <td *ngIf="isViewMode == false && !isEditDisabled(salesQuote, part)">
                                        <select name="priorityId" [(ngModel)]="part.priorityId" required id="priorityId"
                                            #priorityId="ngModel" (change)="onEditPartDetails()">
                                            <option *ngFor="let p of priorities" [ngValue]="p.priorityId">
                                                {{ p.description }}
                                            </option>
                                        </select>
                                    </td>
                                    <td colspan="2" *ngIf="isViewMode == true || isEditDisabled(salesQuote, part)">
                                        {{  part.customerRequestDate | date: "MM/dd/yyyy" }}
                                    </td>
                                    <td colspan="2" *ngIf="isViewMode == false && !isEditDisabled(salesQuote, part)">
                                        <p-calendar [ngClass]="inputValidCheckHeader ? 'p-clder-validate' : ''"
                                            class="pas-clder" [showIcon]="true" appendTo="body"
                                            name="customerRequestDate" [yearNavigator]="true" [monthNavigator]="true"
                                            yearRange="1900:2100" [(ngModel)]="part.customerRequestDate"
                                            (ngModelChange)="onCustomerDateChange(stockIndex, rowIndex)"
                                            #customerRequestDate="ngModel" [minDate]="salesQuote.openDate" required>
                                        </p-calendar>
                                        <div *ngIf="customerRequestDate.invalid && (customerRequestDate.dirty || customerRequestDate.touched)"
                                            class="alert alert-danger alert-danger-cstm">
                                            <div *ngIf="customerRequestDate.errors.required">
                                                <small>Customer Request Date is required </small>
                                            </div>
                                        </div>
                                    </td>
                                    <td colspan="2" *ngIf="isViewMode == true || isEditDisabled(salesQuote, part)">
                                        {{  part.promisedDate | date: "MM/dd/yyyy"}}
                                    </td>
                                    <td colspan="2" *ngIf="isViewMode == false && !isEditDisabled(salesQuote, part)">
                                        <p-calendar [ngClass]="inputValidCheckHeader ? 'p-clder-validate' : ''"
                                            class="pas-clder" [showIcon]="true" appendTo="body" name="promisedDate"
                                            [yearNavigator]="true" [monthNavigator]="true" yearRange="1900:2100"
                                            [(ngModel)]="part.promisedDate" (ngModelChange)="onEditPartDetails()"
                                            #promisedDate="ngModel" [minDate]="salesQuote.openDate" required>
                                        </p-calendar>
                                        <div *ngIf="promisedDate.invalid && (promisedDate.dirty || promisedDate.touched)"
                                            class="alert alert-danger alert-danger-cstm">
                                            <div *ngIf="promisedDate.errors.required">
                                                <small>Promised Date is required </small>
                                            </div>
                                        </div>
                                    </td>
                                    <td colspan="2" *ngIf="isViewMode == true || isEditDisabled(salesQuote, part)">
                                        {{  part.estimatedShipDate | date: "MM/dd/yyyy" }}
                                    </td>
                                    <td colspan="2" *ngIf="isViewMode == false && !isEditDisabled(salesQuote, part)">
                                        <p-calendar [ngClass]="inputValidCheckHeader ? 'p-clder-validate' : ''"
                                            class="pas-clder" [showIcon]="true" appendTo="body" name="estimatedShipDate"
                                            [yearNavigator]="true" [monthNavigator]="true" yearRange="1900:2100"
                                            [(ngModel)]="part.estimatedShipDate" (ngModelChange)="onEditPartDetails()"
                                            #estimatedShipDate="ngModel" [minDate]="salesQuote.openDate" required>
                                        </p-calendar>
                                        <div *ngIf="estimatedShipDate.invalid && (estimatedShipDate.dirty || estimatedShipDate.touched)"
                                            class="alert alert-danger alert-danger-cstm">
                                            <div *ngIf="estimatedShipDate.errors.required">
                                                <small>Estimated Ship Date is required </small>
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        {{ part.conditionDescription }}
                                    </td>
                                    <td colspan="2">
                                        {{ part.stockLineNumber }}
                                    </td>
                                    <td>
                                        {{ part.serialNumber }}
                                    </td>
                                    <td>
                                        {{ salesQuote.openDate | date: "MM/dd/yyyy"}}
                                    </td>
                                    <td class="text-right">
                                        {{ part.qtyAvailable | globalNmberFormat}}
                                    </td>
                                    <td class="text-right">
                                        {{ part.quantityOnHand | globalNmberFormat}}
                                    </td>
                                    <td class="text-right">
                                        {{ part.quantityToBeQuoted | globalNmberFormat}}
                                    </td>
                                    <td class="text-right">
                                        {{ part.quantityAlreadyQuoted | globalNmberFormat}}
                                    </td>
                                    <td *ngIf="isViewMode == false" class="text-left">
                                        {{ salesQuote.statusName }}
                                    </td>
                                    <td *ngIf="isViewMode == true">
                                        {{ salesQuote.status }}
                                    </td>
                                    <td class="text-right">
                                        {{ part.grossSalePricePerUnit | twoDecimalGlobalNumberFormatPipe}}
                                    </td>
                                    <td class="text-right">
                                        {{ part.salesPriceExtended | twoDecimalGlobalNumberFormatPipe}}
                                    </td>
                                    <td class="text-right">
                                        {{ part.misc | twoDecimalGlobalNumberFormatPipe}}
                                    </td>
                                    <td class="text-right">
                                        {{ getTotalRevenue(part) | twoDecimalGlobalNumberFormatPipe}}
                                    </td>
                                    <td class="text-right">
                                        {{ part.unitCostPerUnit | twoDecimalGlobalNumberFormatPipe }}
                                    </td>
                                    <td class="text-right">
                                        {{ part.unitCostExtended | twoDecimalGlobalNumberFormatPipe }}
                                    </td>
                                    <td class="text-right">
                                        {{ getMarginAmount(part) | twoDecimalGlobalNumberFormatPipe}}
                                    </td>
                                    <td class="text-right">
                                        {{ getMarginPercentage(part) | twoDecimalGlobalNumberFormatPipe}}
                                        %</td>
                                    <td class="text-right">
                                        {{ part.freight | twoDecimalGlobalNumberFormatPipe }}
                                    </td>
                                    <td class="text-right">
                                        {{ part.taxAmount | twoDecimalGlobalNumberFormatPipe }}
                                    </td>
                                    <!-- <td class="text-right">
                                        {{ part.unitCostPerUnit  | twoDecimalGlobalNumberFormatPipe }}
                                    </td>
                                    <td class="text-right">
                                        {{ part.markUpPercentage  | twoDecimalGlobalNumberFormatPipe }}
                                    </td>
                                    <td class="text-right">
                                        {{ part.markupPerUnit  | twoDecimalGlobalNumberFormatPipe }}
                                    </td>
                                    <td class="text-right">
                                        {{ part.grossSalePricePerUnit  | twoDecimalGlobalNumberFormatPipe}}
                                    </td>
                                    <td class="text-right">
                                        {{ part.salesDiscount  | twoDecimalGlobalNumberFormatPipe }}
                                    </td>
                                    <td class="text-right">
                                        {{ part.salesDiscountPerUnit  | twoDecimalGlobalNumberFormatPipe }}
                                    </td>
                                    <td class="text-right">
                                        {{ part.markupExtended  | twoDecimalGlobalNumberFormatPipe }}
                                    </td>
                                    <td class="text-right">
                                        {{ part.grossSalePrice | twoDecimalGlobalNumberFormatPipe}}
                                    </td>
                                    <td class="text-right">
                                        {{ part.salesDiscountExtended  | twoDecimalGlobalNumberFormatPipe }}
                                    </td>
                                    <td class="text-right">
                                        {{ part.netSalesPriceExtended  | twoDecimalGlobalNumberFormatPipe }}
                                    </td>
                                    <td class="text-right">
                                        {{ part.taxType }}
                                    </td>
                                    <td class="text-right">
                                        {{ part.taxAmount  | twoDecimalGlobalNumberFormatPipe }}
                                    </td>
                                    <td class="text-right">
                                        {{ part.totalSales  | twoDecimalGlobalNumberFormatPipe }}
                                    </td>
                                    <td class="text-right">
                                        {{ part.unitCostExtended  | twoDecimalGlobalNumberFormatPipe }}
                                    </td>
                                    <td class="text-right">
                                        {{ part.marginAmountExtended  | twoDecimalGlobalNumberFormatPipe }}
                                    </td>
                                    <td class="text-right">
                                        {{ part.marginPercentageExtended  | twoDecimalGlobalNumberFormatPipe }}
                                    </td> -->
                                    <td>
                                        {{ part.pmaStatus }}
                                    </td>
                                    <td>
                                        {{ part.altOrEqType }}
                                    </td>
                                    <td>
                                        {{ part.controlNumber }}
                                    </td>
                                    <td>
                                        {{ part.idNumber }}
                                    </td>
                                    <td class="width-120"
                                        *ngIf="isViewMode == false && !isEditDisabled(salesQuote, part)">
                                        <div class="form-group notes-popup-cstm mat_emo"
                                            style="width: 120px; margin-bottom: 0;">
                                            <div [innerHTML]="part.notes" class="text_editor_box"></div>
                                            <i class="fa fa-pencil fa-lg pull-right nobg parts-memo-icon"
                                                data-toggle="modal" data-target="#textarea-popupNotes"
                                                matTooltip="Notes" matTooltipPosition="above"
                                                (click)="onAddTextAreaInfo(part,stockIndex, rowIndex)"></i>
                                        </div>
                                    </td>
                                    <td *ngIf=" isViewMode==true || isEditDisabled(salesQuote, part)">
                                        <span class="value">
                                            <p class="p-0 m-0 p_textEditor truncate-text" matTooltipPosition="above"
                                                [matTooltip]="parsedText(part.notes)" [innerHTML]="part.notes"></p>
                                        </span>
                                    </td>
                                    <td *ngIf="isViewMode == false" class="zui-sticky-col"
                                        style="width:107px !important">
                                        <a class="btn nobg view-part-eye" data-toggle="tooltip"
                                            [class.disabled]="(part.stockLineNumber == null || part.stockLineNumber == '')"
                                            [ngClass]="{'btn_disabled': (part.stockLineNumber == null || part.stockLineNumber == '')}"
                                            (click)="viewStockSelectedRow(part)" matTooltip="View This StkLine">
                                            <i class="fa fa-eye"></i>
                                        </a>
                                        <!-- <span *ngIf="!isEditDisabled(salesQuote, part)">
                                            <a [class.disabled]="isEditDisabled(salesQuote, part)"
                                                [ngClass]="{'btn_disabled': isEditDisabled(salesQuote, part)}"
                                                class="btn nobg view-part-eye" (click)="openPartToEdit(part)"
                                                matTooltip="Edit Price" matTooltipPosition="above">
                                                <i class="fa fa-pencil"></i>
                                            </a>
                                        </span> -->
                                        <a class="btn nobg view-part-eye" (click)="openPartToEdit(part)"
                                            matTooltip="Edit Price" matTooltipPosition="above">
                                            <i class="fa fa-pencil"></i>
                                        </a>
                                        <span>
                                            <a [class.disabled]="isDeleteDisabled(salesQuote, part)"
                                                [ngClass]="{'btn_disabled': isDeleteDisabled(salesQuote, part)}"
                                                class="btn nobg view-part-eye"
                                                (click)="openPartDelete(deleteContent,part)" matTooltip="Remove"
                                                matTooltipPosition="above">
                                                <i class="fa fa-trash"></i>
                                            </a>
                                        </span>
                                        <span data-toggle="modal" data-target="#soqPartHistory">
                                            <a [ngClass]="{'btn_disabled': !part.salesOrderQuotePartId}"
                                                class="btn nobg btn-hist-cstm view-part-eye"
                                                (click)="getAuditHistoryById(part)" matTooltip="History"
                                                matTooltipPosition="above"><i class="fa fa-history"></i></a>
                                        </span>
                                    </td>
                                </tr>
                            </tbody>
                        </ng-container>
                    </ng-container>
                    <ng-container *ngIf="summaryParts.length == 0">
                        <tbody>
                            <tr>
                                <td colspan="37" class="sales-no-records-found" style="margin-left:-15%">
                                    No records found
                                </td>
                            </tr>
                        </tbody>
                    </ng-container>
                </table>
            </div>
        </div>
    </div>
    <ng-template pTemplate="emptymessage" let-columns>
        <tr>
            <td colspan="23" class="sales-no-records-found">
                No records found
            </td>
        </tr>
    </ng-template>
</div>
<div class="modal fade" id="textarea-popupNotes" role="dialog" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog modal-lg" style="max-width: 400px !important;">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Edit Notes</h4>
            </div>
            <div class="modal-body">
                <p-editor [(ngModel)]="textAreaInfo" [style]="{'height':'320px'}" name="textAreaInfo" required>
                </p-editor>
                <div class="editor-buttons">
                    <button type="button" class="btn btn-primary editor-buttons-margin" data-dismiss="modal"
                        (click)="onSaveTextAreaInfo(textAreaInfo)">
                        Save
                    </button>
                    <button type="button" class="btn btn-danger editor-buttons-margin" data-dismiss="modal">
                        Close
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
<div *ngIf="isViewMode == false" class="view-mode-div">
    <button *ngIf="saveButton" type="button" [disabled]="canSaveParts" class="btn btn-primary view-mode-button"
        (click)="checkIfApprovedPartUpdated()">
        <span>Update</span>
    </button>
    <button type="button" *ngIf="!saveButton" [disabled]="canSaveParts" class="btn btn-primary view-mode-button"
        (click)="approve()">
        <span>Save</span>
    </button>
</div>
<div class="preloader" *ngIf="isSpinnerVisible">
    <div class="loading">
        <div class="lds-roller">
            <div></div>
            <div></div>
            <div></div>
            <div></div>
            <div></div>
            <div></div>
            <div></div>
            <div></div>
        </div>
    </div>
</div>
<ng-template #updateConfirmationModal let-c="close" let-d="dismiss">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" (click)="closeConfirmationModal()">&times;</button>
        <h4 class="modal-title">Do you want to create new version or update existing sales order quote ?</h4>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-danger" data-dismiss="modal"
            (click)="closeConfirmationModal()">Cancel</button>
        <button type="button" class="btn btn-secondary" data-dismiss="modal"
            (click)="createNewSalesOrderQuoteVersion()">
            Create New Version
        </button>
        <button type="button" class="btn btn-primary" data-dismiss="modal" (click)="approve()">Update</button>
    </div>
</ng-template>
<ng-template #updatePNDetailsModal let-c="close" let-d="dismiss">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" (click)="closeConfirmationModal()">&times;</button>
        <h4 class="modal-title">Do you want to save the Part Details?</h4>
    </div>
    <div class="modal-footer">

        <button type="button" class="btn btn-primary" data-dismiss="modal" (click)="approve()">Save</button>
    </div>
</ng-template>
<ng-template #addPart let-c="close" let-d="dismiss">
    <app-add-sales-part-number [display]="show" [selectedParts]="selectedParts" [salesQuote]="salesQuote"
        [isStockLineViewMode]="isStockLineViewMode" [selectedSummaryRow]="selectedSummaryRow" [clearData]="clearData"
        (select)="openSalesMargin($event)" (close)="onClose($event)" [type]="'SOQ'" [isEdit]="isEditMode"
        [isQtyAdjust]="isQtyAdjust" (save)="onSave($event)">
    </app-add-sales-part-number>
</ng-template>

<ng-template #salesMargin let-c="close" let-d="dismiss" tabindex="-1">
    <app-sales-margin tabindex="-1" [part]="part" [isEdit]="isEdit" (save)="openSalesMarginSave($event)"
        (close)="onCloseMargin($event)" (searchAnotherPN)="onSearchAnotherPN($event)"></app-sales-margin>
</ng-template>

<ng-template #deleteContent let-c="close" let-d="dismiss">
    <div class="modal-header">
        <h4 class="modal-title">Are You Sure Want to Delete?</h4>
        <button type="button" class="close" aria-label="Close" (click)="onClosePartDelete()">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body">
        <h6 class="modal-body">Part Number : {{part.partNumber}}</h6>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-success" (click)="deletePart()">Yes</button>
        <button type="button" class="btn btn-danger" (click)="onClosePartDelete()">No</button>
    </div>
</ng-template>
<ng-template #deletePNContent let-c="close" let-d="dismiss">
    <div class="modal-header">
        <h4 class="modal-title">Are You Sure Want to Delete?</h4>
        <button type="button" class="close" aria-label="Close" (click)="onClosePartDelete()">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body">
        <h6 class="modal-body">Part Number : {{part.partNumber}}</h6>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-success" (click)="deletePart()">Yes</button>
        <button type="button" class="btn btn-danger" (click)="onClosePartDelete()">No</button>
    </div>
</ng-template>
<ng-template #partSaveConfirmationModal let-c="close" let-d="dismiss">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" (click)="closeConfirmationModal()">&times;</button>
        <h4 class="modal-title">Do you want to save the Part Details?</h4>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-danger" data-dismiss="modal"
            (click)="closeConfirmationModal()">Cancel</button>
        <button type="button" class="btn btn-primary" data-dismiss="modal" (click)="approve()">Save</button>
    </div>
</ng-template>
<ng-template #contentSOQSummary let-c="close" let-d="dismiss" class="wauto" data-backdrop="static">
    <div class="modal-header">
        <h4 class="modal-title">Sales Order Quote History</h4>
        <button type="button" class="close" aria-label="Close" (click)="dismissModel()">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body">
        <div class="preloader" *ngIf="isSpinnerVisibleHistory">
            <div class="loading">
                <div class="lds-roller">
                    <div></div>
                    <div></div>
                    <div></div>
                    <div></div>
                    <div></div>
                    <div></div>
                    <div></div>
                    <div></div>
                </div>
            </div>
        </div>
        <div class="col">
            <div class="">
                <div class="col" style="padding:3px 0 0;">
                    <div class="form-group float-right">
                        <div class="pull-left radio-buttons-align">
                            <label class="radio-cstm wauto">
                                <input type="radio" name="monthrange" class="form-control" value="1"
                                    (click)="getSOQSummaryDetails('1')" [ngModel]="currentStatusSOQSummary" checked>
                                <span class="checkmark"></span>Last 12 Months
                            </label>
                        </div>
                        <div class="pull-left radio-buttons-align ">
                            <label class="radio-cstm wauto">
                                <input type="radio" name="monthrange" class="form-control" value="2"
                                    (click)="getSOQSummaryDetails('2')" [ngModel]="currentStatusSOQSummary">
                                <span class="checkmark"></span>Last 18 Months
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="table-responsive pas-table-cstm poro-table-cstm parts-list-table-align">
            <div class="table-responsive history_hg" style="overflow-x:auto;">
                <table class="table table-bordered header-table-width">
                    <thead>
                        <tr>
                            <th>PN</th>
                            <th>Cond</th>
                            <th>Cust Appr?</th>
                            <th>Curr</th>
                            <th>Revenue</th>
                            <th>Direct Cost</th>
                            <th>Margin Amt</th>
                            <th>Margin %</th>
                        </tr>
                    </thead>
                    <tr *ngFor="let soqSummPN of soqSummaryPNData;">
                        <td>
                            {{soqSummPN.partNumber}}
                        </td>
                        <td>
                            {{soqSummPN.condition}}
                        </td>
                        <td>
                            {{soqSummPN.custApproved == true ? 'Yes' : 'No'}}
                        </td>
                        <td>
                            {{soqSummPN.currencyName}}
                        </td>
                        <td class="text-right">
                            {{soqSummPN.revenue | twoDecimalGlobalNumberFormatPipe}}
                        </td>
                        <td class="text-right">
                            {{soqSummPN.directCost | twoDecimalGlobalNumberFormatPipe}}
                        </td>
                        <td class="text-right">
                            {{soqSummPN.margin | twoDecimalGlobalNumberFormatPipe}}
                        </td>
                        <td class="text-right">
                            {{soqSummPN.marginPercentage | twoDecimalGlobalNumberFormatPipe}}
                        </td>
                    </tr>
                </table>
            </div>
        </div>
        <div class="table-responsive pas-table-cstm poro-table-cstm parts-list-table-align">
            <div class="table-responsive history_hg" style="overflow-x:auto;">
                <table class="table table-bordered header-table-width">
                    <thead>
                        <tr>
                            <th>Customer</th>
                            <th>Cond</th>
                            <th>Cust Appr?</th>
                            <th>Curr</th>
                            <th>Revenue</th>
                            <th>Direct Cost</th>
                            <th>Margin Amt</th>
                            <th>Margin %</th>
                            <th>SOQ Num</th>
                            <th>SOQ Ver #</th>
                            <th>SOQ Date</th>
                            <th>SO Num</th>
                            <th>Trace</th>
                            <th>Status</th>
                            <th class="table-actions-column">Action</th>
                        </tr>
                    </thead>
                    <tr *ngFor="let soqSummPN of soqSummaryCustData;">
                        <td>
                            {{soqSummPN.customerName}}
                        </td>
                        <td>
                            {{soqSummPN.condition}}
                        </td>
                        <td>
                            {{soqSummPN.custApproved == true ? 'Yes' : 'No'}}
                        </td>
                        <td>
                            {{soqSummPN.currencyName}}
                        </td>
                        <td class="text-right">
                            {{soqSummPN.revenue | twoDecimalGlobalNumberFormatPipe}}
                        </td>
                        <td class="text-right">
                            {{soqSummPN.directCost | twoDecimalGlobalNumberFormatPipe}}
                        </td>
                        <td class="text-right">
                            {{soqSummPN.margin | twoDecimalGlobalNumberFormatPipe}}
                        </td>
                        <td class="text-right">
                            {{soqSummPN.marginPercentage | twoDecimalGlobalNumberFormatPipe}}
                        </td>
                        <td>
                            {{soqSummPN.salesOrderQuoteNum}}
                        </td>
                        <td>
                            {{soqSummPN.versionNumber}}
                        </td>
                        <td>
                            {{soqSummPN.openDate | date: 'MM/dd/yyyy'}}
                        </td>
                        <td>

                        </td>
                        <td>

                        </td>
                        <td>
                            {{soqSummPN.salesOrderQuoteStatus}}
                        </td>
                        <td>
                            <span>
                                <a class="btn nobg btn-view-cstm" (click)="view(viewSalesOrderQuote, soqSummPN)"
                                    matTooltip="View SOQ" matTooltipPosition="above">
                                    <i class="fa fa-eye"></i>
                                </a>
                            </span>
                        </td>
                    </tr>
                </table>
            </div>
        </div>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-danger" (click)="dismissModel()">Close</button>
    </div>
</ng-template>
<ng-template #viewSalesOrderQuote let-c="close" let-d="dismiss" class="wauto" data-backdrop="static">
    <div class="modal-header">
        <button type="button" class="close" (click)="closeViewModel(); salesOrderQuoteId = 0;">
            &times;
        </button>
        <h4 class="modal-title">Sales Order Quote View</h4>
    </div>
    <div class="card-body" *ngIf="isOpenViewSOQ">
        <div class="preloader" *ngIf="isSpinnerVisibleHistory">
            <div class="loading">
                <div class="lds-roller">
                    <div></div>
                    <div></div>
                    <div></div>
                    <div></div>
                    <div></div>
                    <div></div>
                    <div></div>
                    <div></div>
                </div>
            </div>
        </div>
        <app-sales-quote-view [customerId]="customerId" [salesQuoteId]="salesOrderQuoteId"
            [salesQuoteView]="salesQuoteView"></app-sales-quote-view>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-danger" (click)="closeViewModel();">
            Close
        </button>
    </div>
</ng-template>
<div id="soqPartHistory" class="modal fade" role="dialog" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog modal-xlg">

        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" (click)="closeHistoryModal()">&times;</button>
                <h4 class="modal-title">History of Sales Order Quote Part</h4>
            </div>
            <div class="modal-body" *ngIf="auditHistory">
                <div class="table-responsive history_hg" style="overflow-x:auto;">
                    <table class="table table-bordered" *ngIf="auditHistory.length> 0 else noDatavailable">
                        <thead>
                            <tr>
                                <th>PN</th>
                                <th>PN Description</th>
                                <th>Stk Line Num</th>
                                <th>Ser Num</th>
                                <th>Cond</th>
                                <th>Priority</th>
                                <th>Qty Quoted</th>
                                <th>Cust Request Date</th>
                                <th>Cust Promised Date</th>
                                <th>Est.Ship Date</th>
                                <th>Status</th>
                                <th>Cust Ref</th>
                                <th>Unit Cost</th>
                                <th>MarkUp %</th>
                                <th>MarkUp Amt/Unit</th>
                                <th>Disc. Amt/Unit</th>
                                <th>Disc. Amt</th>
                                <th>Disc. %</th>
                                <th>Ext. Cost</th>
                                <th>Fix Rate</th>
                                <th>UOM</th>
                                <th>Product Margin</th>
                                <th>Product Margin (%)</th>
                                <th>Cntrl Num</th>
                                <th>Cntrl ID Num</th>
                                <th>Created Date</th>
                                <th>Created By</th>
                                <th>Updated Date</th>
                                <th>Updated By</th>
                                <th>Is Deleted</th>
                            </tr>
                        </thead>
                        <tbody class="audithistory-cstm">
                            <!--*ngIf="auditHistory.length> 0"-->
                            <tr *ngFor="let audit of auditHistory; let i = index;">
                                <!-- auditHistory[i>0 ? i-1 : i] -->
                                <td
                                    [ngStyle]="{'color':  getColorCodeForHistory(i, 'partNumber', audit.partNumber)  ? 'black' : 'red'  }">
                                    {{audit.partNumber}}</td>
                                <td
                                    [ngStyle]="{'color': getColorCodeForHistory(i, 'partDescription', audit.partDescription)  ? 'black' : 'red'  }">
                                    {{audit.partDescription}}</td>
                                <td
                                    [ngStyle]="{'color': getColorCodeForHistory(i, 'stockLineNumber', audit.stockLineNumber)  ? 'black' : 'red'  }">
                                    {{audit.stockLineNumber}}</td>
                                <td
                                    [ngStyle]="{'color': getColorCodeForHistory(i, 'serialNumber', audit.serialNumber)  ? 'black' : 'red'  }">
                                    {{audit.serialNumber}}</td>
                                <td
                                    [ngStyle]="{'color': getColorCodeForHistory(i, 'conditionDescription', audit.conditionDescription)  ? 'black' : 'red'  }">
                                    {{audit.conditionDescription}}</td>
                                <td
                                    [ngStyle]="{'color': getColorCodeForHistory(i, 'priorityName', audit.priorityName)  ? 'black' : 'red'  }">
                                    {{audit.priorityName}}</td>
                                <td
                                    [ngStyle]="{'color': getColorCodeForHistory(i, 'qtyQuoted', audit.qtyQuoted)  ? 'black' : 'red'  }">
                                    {{audit.qtyQuoted}}</td>
                                <td
                                    [ngStyle]="{'color': getColorCodeForHistory(i, 'customerRequestDate', audit.customerRequestDate)  ? 'black' : 'red'  }">
                                    {{audit.customerRequestDate | date: 'MM/dd/yyyy'}}</td>
                                <td
                                    [ngStyle]="{'color': getColorCodeForHistory(i, 'promisedDate', audit.promisedDate)  ? 'black' : 'red'  }">
                                    {{audit.promisedDate | date: 'MM/dd/yyyy'}}</td>
                                <td
                                    [ngStyle]="{'color': getColorCodeForHistory(i, 'estimatedShipDate', audit.estimatedShipDate)  ? 'black' : 'red'  }">
                                    {{audit.estimatedShipDate | date: 'MM/dd/yyyy'}}</td>

                                <td
                                    [ngStyle]="{'color': getColorCodeForHistory(i, 'statusName', audit.statusName)  ? 'black' : 'red'  }">
                                    {{audit.statusName}}</td>
                                <td
                                    [ngStyle]="{'color': getColorCodeForHistory(i, 'customerReference', audit.customerReference)  ? 'black' : 'red'  }">
                                    {{audit.customerReference}}</td>
                                <td
                                    [ngStyle]="{'color': getColorCodeForHistory(i, 'unitCost', audit.unitCost)  ? 'black' : 'red'  }">
                                    {{audit.unitCost | twoDecimalGlobalNumberFormatPipe}}</td>
                                <td
                                    [ngStyle]="{'color': getColorCodeForHistory(i, 'markUpPercentage', audit.markUpPercentage)  ? 'black' : 'red'  }">
                                    {{audit.markUpPercentage}}</td>
                                <td
                                    [ngStyle]="{'color': getColorCodeForHistory(i, 'markupExtended', audit.markupExtended)  ? 'black' : 'red'  }">
                                    {{audit.markupExtended | twoDecimalGlobalNumberFormatPipe}}</td>
                                <td
                                    [ngStyle]="{'color': getColorCodeForHistory(i, 'discount', audit.discount)  ? 'black' : 'red'  }">
                                    {{audit.discount | twoDecimalGlobalNumberFormatPipe}}</td>
                                <td
                                    [ngStyle]="{'color': getColorCodeForHistory(i, 'discountAmount', audit.discountAmount)  ? 'black' : 'red'  }">
                                    {{audit.discountAmount | twoDecimalGlobalNumberFormatPipe}}</td>
                                <td
                                    [ngStyle]="{'color': getColorCodeForHistory(i, 'salesDiscountExtended', audit.salesDiscountExtended)  ? 'black' : 'red'  }">
                                    {{audit.salesDiscountExtended | twoDecimalGlobalNumberFormatPipe}}</td>
                                <td
                                    [ngStyle]="{'color': getColorCodeForHistory(i, 'unitCostExtended', audit.unitCostExtended)  ? 'black' : 'red'  }">
                                    {{audit.unitCostExtended | twoDecimalGlobalNumberFormatPipe}}</td>
                                <td
                                    [ngStyle]="{'color': getColorCodeForHistory(i, 'fxRate', audit.fxRate)  ? 'black' : 'red'  }">
                                    {{audit.fxRate}}</td>
                                <td
                                    [ngStyle]="{'color': getColorCodeForHistory(i, 'uomName', audit.uomName)  ? 'black' : 'red'  }">
                                    {{audit.uomName}}</td>
                                <td
                                    [ngStyle]="{'color': getColorCodeForHistory(i, 'marginAmountExtended', audit.marginAmountExtended)  ? 'black' : 'red'  }">
                                    {{audit.marginAmountExtended | twoDecimalGlobalNumberFormatPipe}}</td>
                                <td
                                    [ngStyle]="{'color': getColorCodeForHistory(i, 'marginPercentage', audit.marginPercentage)  ? 'black' : 'red'  }">
                                    {{audit.marginPercentage}}</td>

                                <td
                                    [ngStyle]="{'color': getColorCodeForHistory(i, 'controlNumber', audit.controlNumber)  ? 'black' : 'red'  }">
                                    {{audit.controlNumber}}</td>
                                <td
                                    [ngStyle]="{'color': getColorCodeForHistory(i, 'idNumber', audit.idNumber)  ? 'black' : 'red'  }">
                                    {{audit.idNumber}}</td>
                                <td
                                    [ngStyle]="{'color': getColorCodeForHistory(i, 'createdDate', audit.createdDate)  ? 'black' : 'red'  }">
                                    {{audit.createdDate | date: 'MM/dd/yyyy h:mm a '}}</td>
                                <td
                                    [ngStyle]="{'color': getColorCodeForHistory(i, 'createdBy', audit.createdBy)  ? 'black' : 'red'  }">
                                    {{audit.createdBy}}</td>
                                <td
                                    [ngStyle]="{'color': getColorCodeForHistory(i, 'updatedDate', audit.updatedDate)  ? 'black' : 'red'  }">
                                    {{audit.updatedDate | date: 'MM/dd/yyyy h:mm a '}}</td>
                                <td
                                    [ngStyle]="{'color': getColorCodeForHistory(i, 'updatedBy', audit.updatedBy)  ? 'black' : 'red'  }">
                                    {{audit.updatedBy}}</td>
                                <td>
                                    <p class="background-white"> <input type="checkbox" name="isDeleted"
                                            [(ngModel)]="audit.isDeleted" disabled></p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <ng-template #noDatavailable>
                        <div class="text-center">
                            <!-- <img src="../../../../../assets/images/binoculars.png" style="height: 100px; width: 100px;"> -->
                            <h4 class="no-history-found-msg">No History Found </h4>
                        </div>
                    </ng-template>
                </div>
            </div>
            <div class="preloader" style="z-index: 10000;" *ngIf="isSpinnerVisible">
                <div class="loading">
                    <div class="lds-roller">
                        <div>
                        </div>
                        <div></div>
                        <div></div>
                        <div></div>
                        <div></div>
                        <div></div>
                        <div></div>
                        <div></div>
                    </div>
                </div>
            </div>
            <app-spinner *ngIf="isSpinnerVisible"></app-spinner>
            <div class="modal-footer">
                <button type="button" class="btn btn-danger" (click)="closeHistoryModal()">Close</button>
            </div>
        </div>

    </div>
</div>
<ng-template #deletepartcontent let-c="close" let-d="dismiss">
    <div class="modal-header">
        <h4 class="modal-title">Are You Sure Want to Delete?</h4>
        <button type="button" class="close" aria-label="Close" (click)="onCloseParMultipletDelete()">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body">
        <h6 class="modal-body">Part Number : {{selectedSummaryRow.partNumber}}</h6>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-success" (click)="deleteMultiplePart()">Yes</button>
        <button type="button" class="btn btn-danger" (click)="onCloseParMultipletDelete()">No</button>
    </div>
</ng-template>