<div class="card new-card">
  <div class="card-body new-card-body">
    <p-table #dt [value]="sales" class="rpo-table-cstm" [first]="0" [rows]="pageSize" [paginator]="showPaginator"
      [pageLinks]="3" [rowsPerPageOptions]="[10, 20, 50, 100]" [columns]="selectedColumns" selectionMode="multiple"
      [metaKeySelection]="true" [(selection)]="selectedColumn" [lazy]="true" (onLazyLoad)="loadData($event)"
      [totalRecords]="totalRecords" [scrollable]="true" [style]="{ width: '100%' }">
      <ng-template pTemplate="caption">
        <div class="row">
          <!-- <div class="col">
            <p-multiSelect [options]="headers" [(ngModel)]="selectedColumns" optionLabel="header"
              selectedItemsLabel="{0} columns selected" [style]="{minWidth: '200px'}" defaultLabel="Choose Columns"
              style="float:left"></p-multiSelect>
          </div> -->
          <div class="col">
            <!-- <div style="width: auto !important; float: right;"
              class="inner-addon right-addon w50 inline-block g-filter-search-cstm">
              <i class="fa fa-search"></i>
              <input type="text" pInputText size="50" class="form-control" (input)="globalSearch($event.target.value)"
                placeholder="Filter">
            </div> -->
          </div>
        </div>
        <div class="row">
          <div class="col">
            <p-multiSelect [options]="headers" [(ngModel)]="selectedColumns" optionLabel="header"
              selectedItemsLabel="{0} columns selected" [style]="{minWidth: '200px'}" defaultLabel="Choose Columns"
              style="float:left"></p-multiSelect>
          </div>
          <div class="col">
            <div class="pull-left" style="margin-top: 4px; margin-right: 15px;">
              <label class="radio-cstm wauto">
                <input type="radio" name="viewType" class="form-control" value="pnview" [(ngModel)]="viewType"
                  (click)="changeOfStatus('','pnview')">
                <span class="checkmark"></span>PN View
              </label>
            </div>
            <div class="pull-left" style="margin-top: 4px; margin-right: 15px;">
              <label class="radio-cstm wauto">
                <input type="radio" name="viewType" class="form-control" value="detailedview" [(ngModel)]="viewType"
                  (click)="changeOfStatus('','detailedview')">
                <span class="checkmark"></span>Detailed View
              </label>
            </div>
          </div>
          <div class="pull-right" style="padding-left:0px;">
            <div class="">
              <div class="col" style="float: right; padding: 3px 0 0;">

                <div class="form-group">
                  <button type="button" class="btn btn-primary new-table-button" matTooltip="Download Data"
                    matTooltipPosition="above" pButton icon="fa-download" iconPos="left" label="Export Data"
                    (click)="dt.exportCSV()"></button>
                  <button type="button" class="btn btn-primary new-table-button" matTooltip="Download Selected Data"
                    matTooltipPosition="above" pButton icon="fa-download" iconPos="left" label="Export Selected Data"
                    (click)="dt.exportCSV({ selectionOnly: true })"></button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </ng-template>
      <ng-template pTemplate="colgroup" let-columns>
        <colgroup>
          <col *ngFor="let col of columns" [ngStyle]="{'width': col.width}" />
        </colgroup>
      </ng-template>
      <ng-template pTemplate="header" let-columns>
        <tr *ngIf="!pnViewSelected">
          <th colspan="12">&nbsp;
          </th>
          <th colspan="3">Per Unit Revenue
          </th>
          <th colspan="4">Extended Revenue
          </th>
          <th colspan="2">&nbsp;
          </th>
          <th colspan="2">Cost
          </th>
          <th colspan="2">Product Margin
          </th>
        </tr>

        <tr>
          <th *ngFor="let col of columns" [pSortableColumn]="col.field">
            {{ col.header }}
          </th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-rowData let-rowIndex="rowIndex" let-expanded="expanded" let-columns="columns">
        <tr [pSelectableRow]="rowData" [pSelectableRowIndex]="rowIndex" pReorderableRowHandle>
          <td *ngFor="let col of columns" style="text-overflow: ellipsis;"
            [matTooltip]="mouseOverData(col.field,  rowData)" matTooltipPosition="above"
            [matTooltipDisabled]="rowData['partNumberType'] != 'Multiple'"
            [ngStyle]="{'color': getColorCodeForMultiple(rowData)}">
            <span *ngIf="col.field == 'markupPerUnit' || col.field == 'grossSalePricePerUnit'
                || col.field == 'discountAmount'
                || col.field == 'markupExtended'
                || col.field == 'salesDiscountExtended'
                || col.field == 'netSales'
                || col.field == 'misc'
                || col.field == 'grossSalePrice'
                || col.field == 'totalSales'
                || col.field == 'unitCost'
                || col.field == 'unitCostExtended'
                || col.field == 'marginAmountExtended'
                || col.field == 'freight'
                || col.field == 'taxAmount'
                || col.field == 'totalRevenue'
                || col.field == 'marginPercentage'" style="float: right !important;">
              {{convertDate(col.field , rowData) | twoDecimalGlobalNumberFormatPipe}}
            </span>
            <span *ngIf="col.field == 'qty'" style="float: right !important;">
              {{convertDate(col.field , rowData) | globalNmberFormat}}
            </span>
            <span *ngIf="col.field == 'notes'" [innerHTML]="rowData.notes"></span>
            <span *ngIf="col.field != 'qty' 
                && col.field != 'markupPerUnit' 
                && col.field != 'grossSalePricePerUnit'
                && col.field != 'discountAmount'
                && col.field != 'markupExtended'
                && col.field != 'salesDiscountExtended'
                && col.field != 'netSales'
                && col.field != 'misc'
                && col.field != 'grossSalePrice'
                && col.field != 'totalSales'
                && col.field != 'unitCost'
                && col.field != 'unitCostExtended'
                && col.field != 'marginAmountExtended'
                && col.field != 'freight'
                && col.field != 'taxAmount'
                && col.field != 'totalRevenue'
                && col.field != 'marginPercentage'
                && col.field != 'notes'">
              {{convertDate(col.field , rowData)}}
            </span>

          </td>
        </tr>
        <tr *ngIf="!pnViewSelected && rowIndex == (sales.length-1)" class="footer">
          <td colspan="15">&nbsp;
          </td>
          <td><label>Total</label>
          </td>
          <td class="content-to-end"><label>{{getTotalAmount('markupExtended')}}</label>
          </td>
          <td class="content-to-end"><label>{{getTotalAmount('grossSalePrice')}}</label>
          </td>
          <td class="content-to-end"><label>{{getTotalAmount('salesDiscountExtended')}}</label>
          </td>
          <td class="content-to-end"><label>{{getTotalAmount('netSales')}}</label>
          </td>
          <td class="content-to-end"><label>{{getTotalAmount('misc')}}</label>
          </td>
          <td class="content-to-end"><label>{{getTotalAmount('totalSales')}}</label>
          </td>
          <td>&nbsp;
          </td>
          <td class="content-to-end"><label>{{getTotalAmount('unitCostExtended')}}</label>
          </td>
          <td class="content-to-end"><label>{{getTotalAmount('marginAmountExtended')}}</label>
          </td>
          <td class="content-to-end"><label>{{getPercentage('marginPercentage')}}</label>
          </td>
          <td class="content-to-end"><label>{{getTotalAmount('freight')}}</label>
          </td>
          <td class="content-to-end"><label>{{getTotalAmount('taxAmount')}}</label>
          </td>
          <td class="content-to-end"><label>{{getTotalAmount('totalRevenue')}}</label>
          </td>
        </tr>
        <tr *ngIf="pnViewSelected && rowIndex == (sales.length-1)" class="footer">
          <td colspan="6">&nbsp;
          </td>
          <td><label>Total</label>
          </td>
          <td class="content-to-end"><label>{{getTotalAmount('markupExtended')}}</label>
          </td>
          <td class="content-to-end"><label>{{getTotalAmount('grossSalePrice')}}</label>
          </td>
          <td class="content-to-end"><label>{{getTotalAmount('salesDiscountExtended')}}</label>
          </td>
          <td class="content-to-end"><label>{{getTotalAmount('netSales')}}</label>
          </td>
          <td class="content-to-end"><label>{{getTotalAmount('misc')}}</label>
          </td>
          <td class="content-to-end"><label>{{getTotalAmount('totalSales')}}</label>
          </td>
          <td class="content-to-end"><label>{{getTotalAmount('unitCostExtended')}}</label>
          </td>
          <td class="content-to-end"><label>{{getTotalAmount('marginAmountExtended')}}</label>
          </td>
          <td class="content-to-end"><label>{{getPercentage('marginPercentage')}}</label>
          </td>
          <td class="content-to-end"><label>{{getTotalAmount('freight')}}</label>
          </td>
          <td class="content-to-end"><label>{{getTotalAmount('taxAmount')}}</label>
          </td>
          <td class="content-to-end"><label>{{getTotalAmount('totalRevenue')}}</label>
          </td>
        </tr>
      </ng-template>
      <ng-template pTemplate="emptymessage" let-columns *ngIf="sales.length == 0">
        <tr>
          <td [attr.colspan]="10" style="color: red; font-weight: bold; text-align: center">
            No records found
          </td>
        </tr>
      </ng-template>

      <ng-template pTemplate="summary" id="footer">
        <label id="footer" class="footer">Total:</label>
        <input style="width: 5%;" [(ngModel)]="dt._totalRecords" [disabled]="true" pInputText type="text" />
        &nbsp;&nbsp;
        <label id="footer" class="footer1">Pages Count:</label>

        <input style="width: 5%;" [ngModel]="totalPages" [disabled]="true" pInputText type="text" />
      </ng-template>
    </p-table>
  </div>
</div>
<div class="preloader" *ngIf="isSpinnerVisible">
  <div class="loading">
    <div class="lds-roller">
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
    </div>
  </div>
</div>